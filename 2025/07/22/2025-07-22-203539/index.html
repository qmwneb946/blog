<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>单细胞转录组测序分析：洞察生命奥秘的微观旅程 | qmwneb946 的博客</title><meta name="author" content="qmwneb946"><meta name="copyright" content="qmwneb946"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="作者：qmwneb946  引言：从“大锅饭”到“精细菜”——单细胞转录组学的革命 在生物学研究的漫漫长河中，我们对细胞的理解从未停止深化。长期以来，传统的“批量”（Bulk）转录组测序技术是基因表达研究的基石。它通过对数百万个细胞的RNA进行提取和测序，为我们提供了组织、器官或细胞群体中基因表达的平均水平。这种方法犹如品尝一道“大锅饭”，虽然能了解这锅饭的基本味道和主要食材，但却无法分辨其中每一">
<meta property="og:type" content="article">
<meta property="og:title" content="单细胞转录组测序分析：洞察生命奥秘的微观旅程">
<meta property="og:url" content="https://qmwneb946.dpdns.org/2025/07/22/2025-07-22-203539/index.html">
<meta property="og:site_name" content="qmwneb946 的博客">
<meta property="og:description" content="作者：qmwneb946  引言：从“大锅饭”到“精细菜”——单细胞转录组学的革命 在生物学研究的漫漫长河中，我们对细胞的理解从未停止深化。长期以来，传统的“批量”（Bulk）转录组测序技术是基因表达研究的基石。它通过对数百万个细胞的RNA进行提取和测序，为我们提供了组织、器官或细胞群体中基因表达的平均水平。这种方法犹如品尝一道“大锅饭”，虽然能了解这锅饭的基本味道和主要食材，但却无法分辨其中每一">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://qmwneb946.dpdns.org/img/icon.png">
<meta property="article:published_time" content="2025-07-22T12:35:39.000Z">
<meta property="article:modified_time" content="2025-07-23T11:46:17.196Z">
<meta property="article:author" content="qmwneb946">
<meta property="article:tag" content="2025">
<meta property="article:tag" content="计算机科学">
<meta property="article:tag" content="单细胞转录组测序分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qmwneb946.dpdns.org/img/icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "单细胞转录组测序分析：洞察生命奥秘的微观旅程",
  "url": "https://qmwneb946.dpdns.org/2025/07/22/2025-07-22-203539/",
  "image": "https://qmwneb946.dpdns.org/img/icon.png",
  "datePublished": "2025-07-22T12:35:39.000Z",
  "dateModified": "2025-07-23T11:46:17.196Z",
  "author": [
    {
      "@type": "Person",
      "name": "qmwneb946",
      "url": "https://github.com/qmwneb946"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://qmwneb946.dpdns.org/2025/07/22/2025-07-22-203539/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '单细胞转录组测序分析：洞察生命奥秘的微观旅程',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2845632165165414" crossorigin="anonymous"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="qmwneb946 的博客" type="application/atom+xml">
</head><body><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">qmwneb946 的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">单细胞转录组测序分析：洞察生命奥秘的微观旅程</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">单细胞转录组测序分析：洞察生命奥秘的微观旅程<a class="post-edit-link" href="https://github.com/qmwneb946/blog/edit/main/source/_posts/2025-07-22-203539.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-22T12:35:39.000Z" title="发表于 2025-07-22 20:35:39">2025-07-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-23T11:46:17.196Z" title="更新于 2025-07-23 19:46:17">2025-07-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/">计算机科学</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><p><strong>作者：qmwneb946</strong></p>
<hr>
<h3 id="引言：从“大锅饭”到“精细菜”——单细胞转录组学的革命">引言：从“大锅饭”到“精细菜”——单细胞转录组学的革命</h3>
<p>在生物学研究的漫漫长河中，我们对细胞的理解从未停止深化。长期以来，传统的“批量”（Bulk）转录组测序技术是基因表达研究的基石。它通过对数百万个细胞的RNA进行提取和测序，为我们提供了组织、器官或细胞群体中基因表达的平均水平。这种方法犹如品尝一道“大锅饭”，虽然能了解这锅饭的基本味道和主要食材，但却无法分辨其中每一粒米、每一块肉的具体特性，更无法捕捉到那些稀有食材（即稀有细胞亚群）的独特风味。</p>
<p>然而，生命体的复杂性远超我们的想象。即便是看似同质的组织，也可能包含着形态、功能和发育阶段各异的细胞亚群。肿瘤组织中，癌细胞、免疫细胞、成纤维细胞等不同类型细胞交织在一起，其相互作用决定了肿瘤的发生发展和治疗响应；发育生物学中，干细胞在分化过程中经历一系列连续的基因表达变化，驱动着细胞命运的决定；在神经科学中，大脑中数以百计的神经元和胶质细胞类型各自承担着独特的角色，共同构建起复杂的神经网络。批量测序的平均化效应，恰恰模糊了这些至关重要的细胞异质性，使得许多关键的生物学过程和疾病机制难以被揭示。</p>
<p>正是在这样的背景下，**单细胞转录组测序（Single-cell RNA Sequencing, scRNA-seq）**技术应运而生，并在短短数年间，以其革命性的能力，彻底颠覆了我们对生物学系统的认知方式。scRNA-seq 能够对单个细胞内的全部mRNA进行测序，从而在高分辨率下捕获细胞间的异质性。这好比我们将“大锅饭”分解为“精细菜”，每一道菜都代表一个单独的细胞，其独特的风味（基因表达谱）得以清晰呈现。我们现在能够识别前所未见的细胞亚群、追踪细胞分化的轨迹、揭示细胞状态转换的连续过程、绘制细胞间相互作用的网络，甚至理解疾病发生发展过程中细胞层面的细微变化。</p>
<p>然而，单细胞转录组数据的高维度、稀疏性、噪声以及复杂的生物学背景，也给其后续的分析带来了前所未有的挑战。这不仅仅是测序技术的革新，更是计算生物学和生物信息学方法论的一次飞跃。如何从海量的、单个细胞层面的基因表达数据中提取有意义的生物学信息？如何有效地处理数据噪音和技术误差？如何将分散的数据点组织成有条理的生物学发现？这正是本篇文章将要深入探讨的核心内容。</p>
<p>本篇博客旨在为技术爱好者们提供一份全面、深入的单细胞转录组测序分析指南。我们将从技术原理出发，逐步深入到数据预处理、归一化、降维、聚类、细胞类型鉴定、差异表达分析，以及更高级的轨迹推断和细胞间通讯分析等核心步骤。每一个步骤，我们都将不仅介绍“怎么做”，更会深入探讨“为什么这么做”及其背后的数学和统计学原理，并辅以代码示例，希望能够帮助读者构建一个清晰而坚实的单细胞数据分析知识体系，共同探索生命科学的微观世界。</p>
<hr>
<h3 id="单细胞转录组测序技术概述：从宏观到微观的飞跃">单细胞转录组测序技术概述：从宏观到微观的飞跃</h3>
<p>在深入分析单细胞转录组数据之前，我们首先需要理解这些数据是如何产生的。单细胞转录组测序技术的核心目标是从单个细胞中获取其基因表达信息，这与批量测序最大的不同在于其“单细胞捕获”环节。</p>
<h4 id="细胞捕获与文库制备原理">细胞捕获与文库制备原理</h4>
<p>无论采用何种技术平台，单细胞转录组测序的通用流程大致可以概括为以下几个关键步骤：</p>
<ol>
<li><strong>细胞解离与悬浮：</strong> 首先，需要将组织或样本解离成单个细胞的悬浮液。这一步至关重要，因为后续所有操作都基于单个细胞进行。细胞的活性、完整性和单分散性会直接影响测序质量。</li>
<li><strong>单细胞捕获：</strong> 这是单细胞测序技术的标志性步骤。目前主流的捕获方式包括：
<ul>
<li><strong>微流控液滴系统 (Microfluidic Droplet-based Systems):</strong> 如10x Genomics Chromium、Drop-seq、inDrop。这些系统通过微流控芯片将单个细胞、携带有独特条形码（Barcode）的微珠（Bead）以及逆转录酶和缓冲液封装在油滴中。每个油滴形成一个独立的微反应器，确保每个细胞的RNA在逆转录时被标记上唯一的细胞条形码。</li>
<li><strong>微孔板系统 (Microwell-based Systems):</strong> 如Seq-Well。细胞被分配到数千个微孔中，每个微孔底部带有独特条形码的微珠，实现单细胞捕获和标记。</li>
<li><strong>FACS分选 (Fluorescence Activated Cell Sorting) 或激光捕获显微切割 (Laser Capture Microdissection) 到微孔板:</strong> 细胞被分选或提取到96孔/384孔板的单个孔中，每个孔代表一个单细胞。</li>
</ul>
</li>
<li><strong>细胞裂解与RNA逆转录：</strong> 捕获到的单个细胞被裂解，释放出mRNA。细胞内的mRNA通过带有poly-dT引物（用于捕获poly-A尾的mRNA）的特殊引物进行逆转录。这些引物通常带有三个关键序列：
<ul>
<li><strong>UMI (Unique Molecular Identifier)：</strong> 独有的分子识别标签。这是一个短的随机核苷酸序列（通常为8-12bp）。同一个mRNA分子，即使在PCR扩增过程中产生了多个副本，也会带有相同的UMI。UMI的主要作用是纠正PCR扩增偏差，通过计数唯一的UMI来准确量化每个基因的原始mRNA分子数量。</li>
<li><strong>Cell Barcode：</strong> 细胞条形码。这是一个较长的序列（通常为10-16bp），用于识别来自哪个细胞的RNA。在液滴系统中，每个微珠带有一个独特的Cell Barcode。</li>
<li><strong>Poly-dT引物：</strong> 用于捕获mRNA的Poly-A尾，确保只对mRNA进行逆转录。</li>
</ul>
</li>
<li><strong>cDNA扩增与文库构建：</strong> 逆转录产物（cDNA）通过PCR进行扩增，以产生足够数量的DNA用于测序。扩增后的cDNA片段被片段化，并连接上测序接头，形成可用于高通量测序的文库。</li>
<li><strong>高通量测序：</strong> 最后，构建好的文库在二代测序平台（如Illumina NovaSeq/NextSeq）上进行测序。测序数据通常包括Reads 1（包含UMI和Cell Barcode）和Reads 2（包含mRNA序列）。</li>
</ol>
<h4 id="主流技术平台比较">主流技术平台比较</h4>
<ul>
<li><strong>10x Genomics Chromium：</strong> 目前应用最广泛的平台。基于微流控液滴技术，成本相对适中，通量高（每次运行可处理数千到数万个细胞），数据质量稳定。其特有的Cell Ranger软件提供了从原始数据到UMI计数矩阵的完整分析流程。</li>
<li><strong>Drop-seq / inDrop：</strong> 早期基于液滴的技术，原理与10x类似，但通常需要更复杂的实验设置和定制化仪器。</li>
<li><strong>Smart-seq2：</strong> 基于微孔板的单细胞全长转录组测序技术。每个细胞独立处理，能提供更完整的基因转录本信息，包括剪接变体等，但通量较低（一次几十到几百个细胞），成本较高，适用于需要高深度、高覆盖度基因表达信息的场景。</li>
<li><strong>CEL-seq / MARS-seq / Quartz-seq：</strong> 其他基于微孔板或液滴的单细胞测序方法，各有其特点和适用范围。</li>
</ul>
<h4 id="单细胞转录组数据的特点">单细胞转录组数据的特点</h4>
<p>理解数据特点是进行有效分析的前提：</p>
<ol>
<li><strong>稀疏性 (Sparsity)：</strong> 单个细胞内的mRNA含量远低于批量样本，导致许多基因在特定细胞中可能不表达（或表达量极低以至于未被检测到），从而在数据矩阵中出现大量的零值（Zero inflation）。这些零值可能是真正的生物学零（基因不表达），也可能是技术零（基因表达了但未被检测到，即“掉线”Dropout 事件）。稀疏性是单细胞数据分析的最大挑战之一。</li>
<li><strong>高维度 (High Dimensionality)：</strong> 每个细胞的基因表达数据通常包含2万多个基因，使得数据维度非常高。这给数据可视化、聚类和降维带来了挑战。</li>
<li><strong>高噪声与批次效应 (High Noise and Batch Effects)：</strong> 由于捕获效率、逆转录效率、测序深度等实验因素的差异，单细胞数据往往比批量数据含有更高的技术噪音。不同批次或不同实验条件下产生的细胞数据之间可能存在系统性差异，即批次效应，需要专门的方法进行校正。</li>
<li><strong>动态性与连续性 (Dynamicity and Continuity)：</strong> 细胞状态是连续变化的，而不是离散的。传统的聚类方法虽然能识别细胞群，但难以捕捉细胞分化、激活等动态过程中的连续变化，这促使了轨迹推断等方法的兴起。</li>
</ol>
<p>正是这些特点，使得单细胞转录组数据分析需要一系列专门设计的生物信息学工具和统计学方法，以有效应对挑战并挖掘深层生物学信息。接下来的章节将详细介绍这些分析步骤。</p>
<hr>
<h3 id="原始数据预处理：从测序Reads到UMI计数矩阵">原始数据预处理：从测序Reads到UMI计数矩阵</h3>
<p>单细胞转录组测序的原始数据通常是FASTQ文件，其中包含了大量的测序reads。这些reads需要经过一系列复杂的处理，才能转化为我们进行下游分析所需要的UMI计数矩阵。这个过程涉及将Reads与基因组或转录组进行比对，识别并计数每个细胞中每个基因的唯一mRNA分子。</p>
<h4 id="FASTQ文件到UMI计数矩阵">FASTQ文件到UMI计数矩阵</h4>
<p>对于10x Genomics平台的数据，官方提供了<strong>Cell Ranger</strong>软件，它是一个高度自动化且优化的分析流程，能够将原始FASTQ文件直接处理成UMI计数矩阵。Cell Ranger的流程大致包括：</p>
<ol>
<li><strong>Read Trimming (修剪Reads):</strong> 移除测序接头序列、Poly-A尾等非生物学序列。</li>
<li><strong>Cell Barcode和UMI提取与校正:</strong> 从Reads 1中识别并提取Cell Barcode和UMI序列。Cell Ranger会进行Cell Barcode白名单匹配和错误校正，将带有相似但存在测序错误的Barcodes映射到正确的Cell Barcode上。UMI也会进行相似性校正，将由于测序错误导致的相似UMI合并。</li>
<li><strong>Reads比对 (Alignment):</strong> 将Reads 2（包含mRNA序列）比对到参考基因组上，通常使用STAR比对器。这一步会生成比对文件（BAM文件）。</li>
<li><strong>UMI计数 (UMI Counting):</strong> 基于比对结果、Cell Barcode和UMI信息，统计每个细胞中每个基因的唯一UMI数量。一个细胞的同一个基因下，如果多个Reads具有相同的Cell Barcode、相同的UMI和比对到基因组的相同位置，则认为它们来源于同一个mRNA分子，只计为一个UMI。这一步生成一个稀疏矩阵，行是基因，列是细胞，值是UMI计数。</li>
<li><strong>细胞/背景过滤 (Cell/Background Filtering):</strong> Cell Ranger还会根据UMI计数分布（通常是Cell Ranger <code>force-cells</code> 或 <code>cellranger count</code> 的默认算法，例如<code>EmptyDrops</code> 算法）自动区分真实的细胞和环境RNA（Background RNA），生成只包含真实细胞的UMI计数矩阵。</li>
</ol>
<p>对于非10x Genomics平台的数据，或者希望有更多自定义选项的用户，可以使用其他工具：</p>
<ul>
<li><strong>STAR + featureCounts:</strong> 传统RNA-seq常用的组合，但需要额外的脚本来处理Cell Barcode和UMI。</li>
<li><strong>kallisto + bustools:</strong> 基于伪比对（pseudoalignment）的快速工具，结合bustools可以高效地处理单细胞RNA-seq数据，生成UMI计数矩阵。它的速度通常比STAR更快。</li>
</ul>
<p>最终产物是一个巨大的<strong>UMI计数矩阵 (UMI Count Matrix)</strong>，通常以HDF5或MTX格式存储，其行代表基因，列代表细胞，矩阵中的每个元素表示在特定细胞中检测到的特定基因的UMI数量。</p>
<h4 id="质量控制-Quality-Control-QC">质量控制 (Quality Control, QC)</h4>
<p>原始UMI计数矩阵包含了大量细胞和基因，但其中不乏低质量的细胞和表达噪音的基因。质量控制是单细胞分析中至关重要的一步，它旨在识别并移除这些不合格的数据点，确保后续分析的可靠性。不进行严格的质量控制，可能会导致错误的聚类、不准确的细胞类型鉴定和不合理的生物学结论。</p>
<p>常用的质量控制指标包括：</p>
<ol>
<li><strong>每个细胞的UMI数量 (Number of UMIs per cell):</strong> 也称作“文库大小”或“测序深度”。UMI数量过低的细胞可能代表细胞裂解不完全、逆转录效率低下或细胞本身质量差，信息量不足。UMI数量过高的细胞可能是双细胞（Doublets）或多细胞（Multiplets）的混淆，即多个细胞被错误地捕获为一个。</li>
<li><strong>每个细胞中检测到的基因数量 (Number of genes detected per cell):</strong> 这个指标与UMI数量高度相关。检测到的基因数量过少通常意味着细胞质量差或信息量不足。</li>
<li><strong>线粒体基因百分比 (Percentage of mitochondrial genes):</strong> 线粒体基因通常在细胞质中表达。高百分比的线粒体基因（例如超过5%-10%）往往指示细胞膜破损、细胞凋亡或坏死。因为细胞膜破损后，细胞质中的mRNA会流失，但线粒体被膜包裹，其RNA相对稳定，导致线粒体RNA在总RNA中的比例异常升高。</li>
<li><strong>核糖体基因百分比 (Percentage of ribosomal genes):</strong> 有时也会检查核糖体基因的百分比，但其解释相对复杂，不同细胞类型和生理状态下会有较大差异。</li>
</ol>
<p><strong>QC的执行与可视化：</strong></p>
<p>通常，我们会对这些指标设置合理的阈值进行过滤。阈值的选择没有放之四海而皆准的标准，需要根据具体的实验设计、组织类型和预期结果进行调整。通常会通过绘制小提琴图（Violin Plot）和散点图（Scatter Plot）来可视化这些指标的分布，从而确定合适的阈值。</p>
<p><strong>示例代码（使用Seurat包在R中进行QC）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设您已经安装了Seurat包</span></span><br><span class="line"><span class="comment"># install.packages(&quot;Seurat&quot;)</span></span><br><span class="line"><span class="comment"># install.packages(&quot;ggplot2&quot;)</span></span><br><span class="line"><span class="comment"># install.packages(&quot;dplyr&quot;)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>Seurat<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 加载数据 (这里以10x Genomics的Cell Ranger输出为例)</span></span><br><span class="line"><span class="comment"># 假设您的Cell Ranger输出目录为 &#x27;path/to/filtered_feature_bc_matrix&#x27;</span></span><br><span class="line"><span class="comment"># data_dir &lt;- &quot;path/to/filtered_feature_bc_matrix&quot;</span></span><br><span class="line"><span class="comment"># expression_matrix &lt;- Read10X(data.dir = data_dir)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了演示，我们使用Seurat自带的演示数据（PBMC 3k数据集）</span></span><br><span class="line"><span class="comment"># 如果是真实数据，请替换上面的 Read10X 部分</span></span><br><span class="line">pbmc.data <span class="operator">&lt;-</span> Read10X<span class="punctuation">(</span>data.dir <span class="operator">=</span> <span class="string">&quot;D:/R_project/PBMC_3k/filtered_feature_bc_matrix&quot;</span><span class="punctuation">)</span> <span class="comment"># 假设数据在此路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Seurat对象</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> CreateSeuratObject<span class="punctuation">(</span>counts <span class="operator">=</span> pbmc.data<span class="punctuation">,</span> project <span class="operator">=</span> <span class="string">&quot;pbmc3k&quot;</span><span class="punctuation">,</span> min.cells <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> min.features <span class="operator">=</span> <span class="number">200</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 计算线粒体基因百分比</span></span><br><span class="line"><span class="comment"># 线粒体基因在人类基因组中通常以 &quot;MT-&quot; 开头</span></span><br><span class="line">pbmc<span class="punctuation">[[</span><span class="string">&quot;percent.mt&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> PercentageFeatureSet<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> pattern <span class="operator">=</span> <span class="string">&quot;^MT-&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 质量控制指标可视化</span></span><br><span class="line"><span class="comment"># 小提琴图展示每个细胞的基因数量、UMI数量和线粒体百分比分布</span></span><br><span class="line">VlnPlot<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> features <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;nFeature_RNA&quot;</span><span class="punctuation">,</span> <span class="string">&quot;nCount_RNA&quot;</span><span class="punctuation">,</span> <span class="string">&quot;percent.mt&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 散点图：基因数量 vs UMI数量</span></span><br><span class="line">plot1 <span class="operator">&lt;-</span> FeatureScatter<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> feature1 <span class="operator">=</span> <span class="string">&quot;nCount_RNA&quot;</span><span class="punctuation">,</span> feature2 <span class="operator">=</span> <span class="string">&quot;nFeature_RNA&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 散点图：线粒体百分比 vs UMI数量</span></span><br><span class="line">plot2 <span class="operator">&lt;-</span> FeatureScatter<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> feature1 <span class="operator">=</span> <span class="string">&quot;nCount_RNA&quot;</span><span class="punctuation">,</span> feature2 <span class="operator">=</span> <span class="string">&quot;percent.mt&quot;</span><span class="punctuation">)</span></span><br><span class="line">CombinePlots<span class="punctuation">(</span>plots <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>plot1<span class="punctuation">,</span> plot2<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 根据阈值进行过滤</span></span><br><span class="line"><span class="comment"># 假设我们设置的过滤标准：</span></span><br><span class="line"><span class="comment"># - 基因数量在 200 到 2500 之间</span></span><br><span class="line"><span class="comment"># - UMI数量小于 10000</span></span><br><span class="line"><span class="comment"># - 线粒体基因百分比小于 5%</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> subset <span class="operator">=</span> nFeature_RNA <span class="operator">&gt;</span> <span class="number">200</span> <span class="operator">&amp;</span> nFeature_RNA <span class="operator">&lt;</span> <span class="number">2500</span> <span class="operator">&amp;</span> </span><br><span class="line">                  nCount_RNA <span class="operator">&lt;</span> <span class="number">10000</span> <span class="operator">&amp;</span> percent.mt <span class="operator">&lt;</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤后的细胞和基因数量</span></span><br><span class="line"><span class="built_in">dim</span><span class="punctuation">(</span>pbmc<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><strong>双细胞/多细胞检测 (Doublet Detection):</strong><br>
除了上述指标，双细胞或多细胞是另一个常见的技术伪影，它们是由两个或更多细胞被错误地捕获为一个“单细胞”造成的。双细胞的表达谱是其组成细胞表达谱的混合，这可能会导致在聚类分析中出现“中间”或“混合”的细胞群，从而干扰细胞类型鉴定。<br>
常用的双细胞检测工具包括：</p>
<ul>
<li><strong>DoubletFinder</strong></li>
<li><strong>Scrublet</strong> (Python)</li>
<li><strong>SoupX</strong> (主要用于背景RNA去除)</li>
</ul>
<p>这些工具通常基于模拟双细胞（将两个随机选择的单细胞数据进行合并）并与真实数据进行比较来识别双细胞。</p>
<p>通过严格的质量控制，我们能够去除低质量的细胞和技术噪音，为后续的复杂分析奠定坚实的基础。</p>
<hr>
<h3 id="数据归一化与尺度化：消除技术偏差，揭示生物学真实">数据归一化与尺度化：消除技术偏差，揭示生物学真实</h3>
<p>经过质量控制后，我们获得了高质量的UMI计数矩阵。然而，这个矩阵中的原始UMI计数并不能直接用于比较和分析。这是因为不同细胞的测序深度（即总UMI数量）存在巨大差异，细胞大小和mRNA含量也各有不同，这些技术性的变异会掩盖真实的生物学差异。因此，**归一化（Normalization）<strong>和</strong>尺度化（Scaling）**是单细胞数据分析中至关重要的步骤，旨在消除这些非生物学因素带来的偏差，使得不同细胞之间的基因表达量能够进行有意义的比较。</p>
<h4 id="为什么需要归一化？">为什么需要归一化？</h4>
<p>想象一下，我们有两个细胞，A和B，它们都表达基因X。细胞A的测序深度是10,000 UMIs，基因X的UMI计数是10；细胞B的测序深度是1,000 UMIs，基因X的UMI计数也是10。如果直接比较，两个细胞的基因X表达量似乎相同。但实际上，基因X在细胞B中占总UMIs的比例是1% (10/1000)，而在细胞A中是0.1% (10/10000)。显然，在细胞B中基因X相对表达更高。归一化的目的就是将这些原始计数转换为一个可比较的尺度，例如表达量的比例或相对丰度。</p>
<p>此外，单细胞RNA-seq数据中普遍存在的“掉线”（Dropout）事件，即基因实际表达但由于测序深度不足或随机取样丢失而未被检测到，也增加了归一化和下游分析的复杂性。</p>
<h4 id="常用归一化方法">常用归一化方法</h4>
<ol>
<li>
<p><strong>LogNormalize (Seurat默认方法)：</strong><br>
这是Seurat包中广泛使用的方法。其核心思想是将每个细胞的基因表达量除以该细胞的总UMI计数（或一个尺度因子），然后乘以一个全局尺度因子（通常是10,000），最后进行对数变换。<br>
公式为：<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>E</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mi>e</mi></msub><mrow><mo fence="true">(</mo><mfrac><msub><mi>E</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mrow><msub><mo>∑</mo><mi>k</mi></msub><msub><mi>E</mi><mrow><mi>k</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow></mfrac><mo>×</mo><mtext>scale_factor</mtext><mo>+</mo><mn>1</mn><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">E_{i,j}&#x27; = \log_e \left( \frac{E_{i,j}}{\sum_k E_{k,j}} \times \text{scale\_factor} + 1 \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1467em;vertical-align:-0.3948em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0573em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9857em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1746em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3214em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0576em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5073em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0576em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.57em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord text"><span class="mord">scale_factor</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span><br>
其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E_{i,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 是细胞 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 中基因 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 的原始UMI计数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>k</mi></msub><msub><mi>E</mi><mrow><mi>k</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sum_k E_{k,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0497em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1864em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 是细胞 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 的总UMI计数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>scale_factor</mtext></mrow><annotation encoding="application/x-tex">\text{scale\_factor}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">scale_factor</span></span></span></span></span> 常用10,000。加1是为了避免对零值取对数。<br>
这种方法将原始计数转换为对数化的每万个UMI的计数 (Log Counts Per 10k)。</p>
</li>
<li>
<p><strong>SCTransform (Seurat v3+ 推荐方法)：</strong><br>
SCTransform (Sparse Correspondence Transform) 是一种更先进的归一化方法，它不仅归一化数据，还能同时对生物学变异和技术噪音进行建模，并去除技术噪音（如测序深度、掉线事件）的影响。<br>
SCTransform 基于<strong>广义线性模型 (Generalized Linear Model, GLM)</strong>。它假设每个基因的表达量遵循泊松或负二项分布（考虑到单细胞数据的过度离散性），并以细胞的测序深度为协变量来拟合模型。通过去除模型中由测序深度解释的变异，SCTransform能够识别出残差（residuals），这些残差被认为是与生物学差异更相关的信号。<br>
核心思想是：对于每个基因，建立一个回归模型：<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>g</mi></msub><mo>∼</mo><mtext>Negative Binomial</mtext><mo stretchy="false">(</mo><msub><mi>μ</mi><mi>g</mi></msub><mo separator="true">,</mo><msub><mi>θ</mi><mi>g</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Y_g \sim \text{Negative Binomial}(\mu_g, \theta_g)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord text"><span class="mord">Negative Binomial</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>μ</mi><mi>g</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\log(\mu_g) = \beta_0 + \beta_1 \log(Depth)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord mathnormal">De</span><span class="mord mathnormal">pt</span><span class="mord mathnormal">h</span><span class="mclose">)</span></span></span></span><br>
其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">Y_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 是基因 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span> 的计数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">\mu_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 是均值，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">\theta_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 是离散度参数。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\log(Depth)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord mathnormal">De</span><span class="mord mathnormal">pt</span><span class="mord mathnormal">h</span><span class="mclose">)</span></span></span></span> 是细胞的对数总UMI计数。通过这个模型，我们计算残差，残差代表了在考虑测序深度后基因表达量的偏差。<br>
SCTransform的优点在于：</p>
<ul>
<li>能更好地处理掉线事件。</li>
<li>自动识别并去除与测序深度相关的技术噪音。</li>
<li>直接输出一个“整合的”、去除了技术噪音的表达矩阵，适用于降维和聚类。</li>
<li>具有更高的计算效率。</li>
</ul>
</li>
<li>
<p><strong>CPM (Counts Per Million) / TPM (Transcripts Per Million) / RPKM/FPKM：</strong><br>
CPM 是将原始计数除以总计数，然后乘以一百万。TPM/RPKM/FPKM 进一步考虑了基因的长度。这些方法在批量RNA-seq中常用，但在单细胞数据中，由于其高稀疏性和掉线问题，直接使用这些方法效果不如LogNormalize或SCTransform。</p>
</li>
</ol>
<p><strong>选择哪种方法？</strong></p>
<ul>
<li>对于初学者或快速分析，<code>LogNormalize</code> 是一个稳健的选择。</li>
<li>对于更复杂的项目，或当数据存在明显技术噪音和掉线问题时，<code>SCTransform</code> 通常能提供更好的性能和更清晰的下游结果。它被认为是目前处理单细胞RNA-seq数据去噪音和归一化的黄金标准之一。</li>
</ul>
<h4 id="数据尺度化-Scaling">数据尺度化 (Scaling)</h4>
<p>在进行降维（如PCA）之前，通常需要对归一化后的数据进行尺度化。尺度化的目的是使每个基因的表达量在不同细胞间具有可比性。常用的尺度化方法是<strong>Z-score标准化</strong>，即减去每个基因的均值，然后除以其标准差。<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><msubsup><mi>E</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>−</mo><msub><mi>μ</mi><mi>i</mi></msub></mrow><msub><mi>σ</mi><mi>i</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">Z_{i,j} = \frac{E_{i,j}&#x27; - \mu_i}{\sigma_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.632em;vertical-align:-0.4451em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1869em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6074em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.214em;margin-left:-0.0576em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4249em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><br>
其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>E</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">E_{i,j}&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1467em;vertical-align:-0.3948em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span></span></span></span> 是归一化后的细胞 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 中基因 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 的表达量，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是基因 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 在所有细胞中的均值，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\sigma_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是基因 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 在所有细胞中的标准差。<br>
这一步也常用于识别高变基因 (Highly Variable Genes, HVG)。</p>
<p><strong>示例代码（使用Seurat包在R中进行归一化和尺度化）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接着上一步QC后的pbmc对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 使用LogNormalize进行归一化</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> NormalizeData<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> normalization.method <span class="operator">=</span> <span class="string">&quot;LogNormalize&quot;</span><span class="punctuation">,</span> scale.factor <span class="operator">=</span> <span class="number">10000</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 识别高变基因 (Highly Variable Features)</span></span><br><span class="line"><span class="comment"># 这一步旨在选择那些在不同细胞间表达量波动最大的基因，这些基因往往携带最多的生物学信息。</span></span><br><span class="line"><span class="comment"># LogNormalize后，默认使用 &#x27;vst&#x27; 方法来识别高变基因，其本质是计算方差稳定变换后的残差方差。</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> FindVariableFeatures<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> selection.method <span class="operator">=</span> <span class="string">&quot;vst&quot;</span><span class="punctuation">,</span> nfeatures <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化高变基因</span></span><br><span class="line">top10 <span class="operator">&lt;-</span> head<span class="punctuation">(</span>VariableFeatures<span class="punctuation">(</span>pbmc<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">plot3 <span class="operator">&lt;-</span> VariableFeaturePlot<span class="punctuation">(</span>pbmc<span class="punctuation">)</span></span><br><span class="line">plot4 <span class="operator">&lt;-</span> LabelPoints<span class="punctuation">(</span>plot <span class="operator">=</span> plot3<span class="punctuation">,</span> points <span class="operator">=</span> top10<span class="punctuation">,</span> repel <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">CombinePlots<span class="punctuation">(</span>plots <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>plot3<span class="punctuation">,</span> plot4<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 尺度化数据</span></span><br><span class="line"><span class="comment"># 这一步将对所有基因（或者只对高变基因）进行线性变换（Z-score），</span></span><br><span class="line"><span class="comment"># 使得每个基因的均值为0，方差为1。这是PCA等线性降维方法的预处理。</span></span><br><span class="line"><span class="comment"># 也可以指定 &#x27;features&#x27; 参数只对高变基因进行尺度化以节省内存和计算时间。</span></span><br><span class="line"><span class="comment"># 这里我们对所有在FindVariableFeatures中识别的高变基因进行尺度化</span></span><br><span class="line">all.genes <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>pbmc<span class="punctuation">)</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> ScaleData<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> features <span class="operator">=</span> all.genes<span class="punctuation">)</span> <span class="comment"># 或者 pbmc &lt;- ScaleData(pbmc) # 如果只处理高变基因</span></span><br></pre></td></tr></table></figure>
<p><strong>示例代码（使用SCTransform进行归一化和尺度化）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新加载数据，因为SCTransform会取代NormalizeData和ScaleData</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> CreateSeuratObject<span class="punctuation">(</span>counts <span class="operator">=</span> pbmc.data<span class="punctuation">,</span> project <span class="operator">=</span> <span class="string">&quot;pbmc3k&quot;</span><span class="punctuation">,</span> min.cells <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> min.features <span class="operator">=</span> <span class="number">200</span><span class="punctuation">)</span></span><br><span class="line">pbmc<span class="punctuation">[[</span><span class="string">&quot;percent.mt&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> PercentageFeatureSet<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> pattern <span class="operator">=</span> <span class="string">&quot;^MT-&quot;</span><span class="punctuation">)</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> subset <span class="operator">=</span> nFeature_RNA <span class="operator">&gt;</span> <span class="number">200</span> <span class="operator">&amp;</span> nFeature_RNA <span class="operator">&lt;</span> <span class="number">2500</span> <span class="operator">&amp;</span> </span><br><span class="line">                  nCount_RNA <span class="operator">&lt;</span> <span class="number">10000</span> <span class="operator">&amp;</span> percent.mt <span class="operator">&lt;</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用SCTransform进行归一化和尺度化</span></span><br><span class="line"><span class="comment"># SCTransform会自动识别高变基因，并输出一个校正后的表达矩阵。</span></span><br><span class="line"><span class="comment"># 它会生成一个名为 &#x27;SCT&#x27; 的assay，其中包含归一化后的残差数据。</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> SCTransform<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> vars.to.regress <span class="operator">=</span> <span class="string">&quot;percent.mt&quot;</span><span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># vars.to.regress 参数可以用来回归掉一些技术协变量，例如线粒体基因百分比，以进一步去除噪音。</span></span><br></pre></td></tr></table></figure>
<h4 id="批次效应校正-Batch-Effect-Correction">批次效应校正 (Batch Effect Correction)</h4>
<p>在许多实验中，样本可能分批进行测序，或者来源于不同的捐赠者、不同的实验条件。这会导致不同批次之间存在系统性的非生物学差异，即<strong>批次效应</strong>。批次效应如果不加以校正，可能会导致不同批次的细胞错误地聚在一起，或者相同细胞类型的细胞被错误地分开。</p>
<p>常用的批次效应校正方法：</p>
<ol>
<li>
<p><strong>基于CCA的整合 (Canonical Correlation Analysis based Integration, Seurat <code>IntegrateData</code>):</strong><br>
Seurat v3引入的整合功能，核心是利用CCA寻找不同数据集中共享的、由生物学变异驱动的“共同”信号，并对这些共享维度进行锚点识别（Anchoring），然后基于锚点对数据进行校正和整合。它适用于整合来自不同实验、不同捐赠者或不同测序平台的数据。</p>
<ul>
<li><strong>原理：</strong> CCA旨在找到两组多变量数据（这里是两个批次的基因表达矩阵）的最大相关线性组合。Seurat的整合流程通过识别不同批次中相互对应的细胞（锚点），这些锚点代表了生物学上相同的细胞状态。</li>
<li><strong>步骤：</strong>
<ol>
<li>对每个批次单独进行归一化和高变基因识别。</li>
<li>使用<code>FindIntegrationAnchors</code>找到批次间的锚点。</li>
<li>使用<code>IntegrateData</code>函数将所有批次的数据整合到一个统一的维度空间中。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>Harmony：</strong><br>
一种快速、可扩展的迭代批次校正算法。它通过最小化细胞聚类内的批次效应来调整细胞嵌入，同时保留细胞异质性。Harmony不直接修改原始数据，而是在降维后的空间中进行调整。</p>
<ul>
<li><strong>原理：</strong> Harmony是一个迭代优化过程。它根据细胞的簇归属来调整每个细胞的坐标，使得不同批次但属于同一簇的细胞之间的距离最小化。这个过程不断重复，直到批次效应最小化。</li>
</ul>
</li>
<li>
<p><strong>MNN (Mutual Nearest Neighbors):</strong><br>
基于相互最近邻的批次校正方法。它通过识别不同批次之间相互作为最近邻的细胞对（MNN对），假设这些MNN对是相同细胞类型的代表，然后计算它们之间的向量差来估算批次效应，并对所有细胞进行校正。</p>
<ul>
<li><strong>原理：</strong> 如果一个细胞A在批次1中，其最近邻是批次2中的细胞B，同时细胞B的最近邻是批次1中的细胞A，那么A和B就被认为是一对MNN。MNN对之间的差异被认为是批次效应。</li>
</ul>
</li>
<li>
<p><strong>LIGER (Linked Inference of Genomic Experimental Relationships):</strong><br>
一种基于非负矩阵分解 (Non-negative Matrix Factorization, NMF) 的整合方法，旨在识别跨数据集共享和数据集特异性的基因表达模式。</p>
</li>
</ol>
<p><strong>示例代码（Seurat v3 CCA整合）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设您有两个批次的数据，pbmc.list是一个包含Seurat对象的列表</span></span><br><span class="line"><span class="comment"># pbmc.list &lt;- list(pbmc_batch1, pbmc_batch2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了演示，我们先分割pbmc3k数据集模拟两个批次</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">123</span><span class="punctuation">)</span></span><br><span class="line">cells_batch1 <span class="operator">&lt;-</span> sample<span class="punctuation">(</span>colnames<span class="punctuation">(</span>pbmc<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>ncol<span class="punctuation">(</span>pbmc<span class="punctuation">)</span> <span class="operator">/</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">cells_batch2 <span class="operator">&lt;-</span> setdiff<span class="punctuation">(</span>colnames<span class="punctuation">(</span>pbmc<span class="punctuation">)</span><span class="punctuation">,</span> cells_batch1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pbmc_batch1 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> cells <span class="operator">=</span> cells_batch1<span class="punctuation">)</span></span><br><span class="line">pbmc_batch2 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> cells <span class="operator">=</span> cells_batch2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pbmc.list <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>pbmc_batch1<span class="punctuation">,</span> pbmc_batch2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对每个Seurat对象进行标准化和识别高变基因</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>pbmc.list<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  pbmc.list<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> NormalizeData<span class="punctuation">(</span>pbmc.list<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  pbmc.list<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> FindVariableFeatures<span class="punctuation">(</span>pbmc.list<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> selection.method <span class="operator">=</span> <span class="string">&quot;vst&quot;</span><span class="punctuation">,</span> nfeatures <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 寻找整合锚点</span></span><br><span class="line">anchors <span class="operator">&lt;-</span> FindIntegrationAnchors<span class="punctuation">(</span>object.list <span class="operator">=</span> pbmc.list<span class="punctuation">,</span> dims <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">30</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 整合数据</span></span><br><span class="line">pbmc.integrated <span class="operator">&lt;-</span> IntegrateData<span class="punctuation">(</span>anchorset <span class="operator">=</span> anchors<span class="punctuation">,</span> dims <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">30</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保所有后续分析都在整合后的&quot;integrated&quot; assay进行</span></span><br><span class="line">DefaultAssay<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="string">&quot;integrated&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次进行尺度化，这次是对整合后的数据进行</span></span><br><span class="line">pbmc.integrated <span class="operator">&lt;-</span> ScaleData<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>归一化、尺度化和批次效应校正共同构成了单细胞数据分析的“基石”。它们有效清除了数据中的技术噪音和批次差异，使得我们能够在此基础上更准确地进行后续的降维、聚类和生物学解释。</p>
<hr>
<h3 id="降维：揭示高维数据中的内在结构">降维：揭示高维数据中的内在结构</h3>
<p>单细胞转录组数据通常包含数万个基因，每个基因都是一个维度。这种“高维度”的数据虽然包含了丰富的生物学信息，但也带来了巨大的挑战：</p>
<ol>
<li><strong>可视化困难：</strong> 我们无法直观地在二维或三维空间中呈现超过三个维度的信息。</li>
<li><strong>“维度灾难”：</strong> 在高维空间中，数据点变得非常稀疏，距离度量失效，使得聚类、分类等算法的性能下降。</li>
<li><strong>计算效率低下：</strong> 处理高维数据需要大量的计算资源。</li>
</ol>
<p>**降维（Dimensionality Reduction）**技术应运而生，其核心目标是将高维数据投影到低维空间（通常是2D或3D），同时尽可能保留原始数据中最重要的结构和信息，例如细胞之间的相似性。这使得我们能够可视化细胞群、识别细胞亚型以及理解细胞状态的连续变化。</p>
<h4 id="主成分分析-Principal-Component-Analysis-PCA">主成分分析 (Principal Component Analysis, PCA)</h4>
<p>PCA是最常用的线性降维方法之一。</p>
<ul>
<li><strong>原理：</strong> PCA通过正交变换将数据投影到一个新的坐标系，新坐标系的轴是“主成分”（Principal Components, PCs）。每个主成分都是原始基因表达量的一个线性组合。PCA的目标是找到一系列相互正交的轴，使得数据在这些轴上的方差最大化。第一个主成分捕捉数据中最大的方差，第二个主成分捕捉与第一个主成分正交的剩余最大方差，依此类推。<br>
PCA的数学本质是计算数据协方差矩阵的特征值分解。<br>
假设我们有一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>×</mo><mi>G</mi></mrow><annotation encoding="application/x-tex">N \times G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span> 的矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> 是细胞数量，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span> 是基因数量。首先对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 进行中心化（每个基因减去其均值）。然后计算协方差矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></mfrac><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">C = \frac{1}{N-1} X^T X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2484em;vertical-align:-0.4033em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>。PCA的目标是找到一个投影矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span>，使得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mi>W</mi><mo>=</mo><mi>X</mi><mi>W</mi></mrow><annotation encoding="application/x-tex">YW = XW</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">YW</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> 中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> 的方差最大化。 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> 的列就是协方差矩阵的特征向量（主成分），对应的特征值表示该主成分捕获的方差大小。</li>
<li><strong>应用：</strong>
<ul>
<li>降低数据维度，为后续的非线性降维（如t-SNE、UMAP）提供输入。</li>
<li>去除数据中的噪音，因为通常前几个主成分捕获的是主要生物学变异，而高阶主成分往往与噪音相关。</li>
<li>通过碎石图（Elbow Plot）或基于统计学的方法（如JackStraw）来确定保留多少个主成分，这些主成分足以捕获大部分生物学信息。</li>
</ul>
</li>
</ul>
<h4 id="t-SNE-t-Distributed-Stochastic-Neighbor-Embedding">t-SNE (t-Distributed Stochastic Neighbor Embedding)</h4>
<p>t-SNE是一种非线性降维方法，特别擅长在高维数据中揭示复杂的局部结构，并在二维或三维空间中清晰地显示聚类。</p>
<ul>
<li><strong>原理：</strong><br>
t-SNE的核心思想是将高维空间中的数据点之间的相似性转换为低维空间中的相似性，并最小化这两个相似性分布之间的Kullback-Leibler (KL) 散度。
<ol>
<li><strong>高维相似性：</strong> 在高维空间中，t-SNE使用高斯分布来衡量数据点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">x_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 之间的相似性 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>j</mi><mi mathvariant="normal">∣</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{j|i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>。对于给定的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，其他点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">x_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的相似度 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>j</mi><mi mathvariant="normal">∣</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{j|i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span> 越高，说明 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">x_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 越可能是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的近邻。<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>j</mi><mi mathvariant="normal">∣</mi><mi>i</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mi mathvariant="normal">∥</mi><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>x</mi><mi>j</mi></msub><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup><mi mathvariant="normal">/</mi><mn>2</mn><msubsup><mi>σ</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="false">)</mo></mrow><mrow><msub><mo>∑</mo><mrow><mi>k</mi><mo mathvariant="normal">≠</mo><mi>i</mi></mrow></msub><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mi mathvariant="normal">∥</mi><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>x</mi><mi>k</mi></msub><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup><mi mathvariant="normal">/</mi><mn>2</mn><msubsup><mi>σ</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">p_{j|i} = \frac{\exp(-\|x_i - x_j\|^2 / 2\sigma_i^2)}{\sum_{k \neq i} \exp(-\|x_i - x_k\|^2 / 2\sigma_i^2)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8299em;vertical-align:-0.6958em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1341em;"><span style="top:-2.6264em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1746em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord mtight"><span class="mrel mtight"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4603em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mop mtight"><span class="mtight">e</span><span class="mtight">x</span><span class="mtight">p</span></span><span class="mopen mtight">(</span><span class="mord mtight">−</span><span class="mord mtight">∥</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mtight">/2</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1777em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5102em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">e</span><span class="mtight">x</span><span class="mtight">p</span></span><span class="mopen mtight">(</span><span class="mord mtight">−</span><span class="mord mtight">∥</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mtight">/2</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.214em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6958em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><br>
这里 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\sigma_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 相关的带宽参数，它决定了高斯分布的宽度。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\sigma_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的选择与<strong>perplexity</strong>参数有关，perplexity可以被认为是每个点拥有的有效近邻数量，通常在5到50之间。<br>
为了处理不对称性，高维相似性 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 通常取 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>j</mi><mi mathvariant="normal">∣</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{j|i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi><mi mathvariant="normal">∣</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i|j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span> 的平均值：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>p</mi><mrow><mi>j</mi><mi mathvariant="normal">∣</mi><mi>i</mi></mrow></msub><mo>+</mo><msub><mi>p</mi><mrow><mi>i</mi><mi mathvariant="normal">∣</mi><mi>j</mi></mrow></msub><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn><mi>N</mi></mrow><annotation encoding="application/x-tex">P_{ij} = (p_{j|i} + p_{i|j}) / 2N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">/2</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>。</li>
<li><strong>低维相似性：</strong> 在低维空间（通常是2D）中，t-SNE使用学生t-分布来衡量数据点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 之间的相似性 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">q_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>。学生t-分布的“重尾”特性有助于将低维空间中的点推开，从而解决“拥挤问题”（crowding problem，即高维空间中的少量近邻点在低维空间中会被压缩）。<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi mathvariant="normal">∥</mi><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>y</mi><mi>j</mi></msub><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><mrow><msub><mo>∑</mo><mrow><mi>k</mi><mo mathvariant="normal">≠</mo><mi>l</mi></mrow></msub><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi mathvariant="normal">∥</mi><msub><mi>y</mi><mi>k</mi></msub><mo>−</mo><msub><mi>y</mi><mi>l</mi></msub><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">q_{ij} = \frac{(1 + \|y_i - y_j\|^2)^{-1}}{\sum_{k \neq l} (1 + \|y_k - y_l\|^2)^{-1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.7985em;vertical-align:-0.6672em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1312em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1746em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord mtight"><span class="mrel mtight"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4603em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight">∥</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5073em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight">∥</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6672em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li>
<li><strong>优化：</strong> t-SNE通过梯度下降优化算法，迭代地调整低维嵌入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>，以最小化高维相似性分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> 和低维相似性分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 之间的KL散度：<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>L</mi><mo stretchy="false">(</mo><mi>P</mi><mi mathvariant="normal">∥</mi><mi>Q</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo mathvariant="normal">≠</mo><mi>j</mi></mrow></msub><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>log</mi><mo>⁡</mo><mfrac><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>Q</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">KL(P \| Q) = \sum_{i \neq j} P_{ij} \log \frac{P_{ij}}{Q_{ij}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">∥</span><span class="mord mathnormal">Q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.528em;vertical-align:-0.5423em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1864em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord mtight"><span class="mrel mtight"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9857em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5073em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li>
</ol>
</li>
<li><strong>优点：</strong> 善于揭示数据的局部结构，能很好地将不同的细胞群分隔开。</li>
<li><strong>缺点：</strong>
<ul>
<li>计算成本高，不适合大数据集（虽然有加速版本）。</li>
<li>结果依赖于随机初始化，每次运行结果可能略有不同。</li>
<li>不同簇之间的距离不代表真实的生物学距离，簇的大小和形状也没有生物学意义。</li>
<li>难以保留全局结构。</li>
</ul>
</li>
</ul>
<h4 id="UMAP-Uniform-Manifold-Approximation-and-Projection">UMAP (Uniform Manifold Approximation and Projection)</h4>
<p>UMAP是另一种非线性降维方法，在许多方面优于t-SNE。</p>
<ul>
<li><strong>原理：</strong> UMAP基于流形学习（Manifold Learning）和拓扑数据分析（Topological Data Analysis）的理论框架。它假设高维数据点位于一个低维流形上，并试图找到这个流形在低维空间中的最佳表示。<br>
UMAP的关键思想是构建一个加权K近邻图（weighted k-nearest neighbor graph）来表示高维空间中的数据结构，然后在低维空间中构建一个类似的图，并通过优化算法使这两个图尽可能相似。<br>
它通过最小化交叉熵来优化低维嵌入：<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>X</mi><mo separator="true">,</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">[</mo><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mfrac><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>Q</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mfrac><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">)</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mfrac><mrow><mn>1</mn><mo>−</mo><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><mrow><mn>1</mn><mo>−</mo><msub><mi>Q</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">C(X, Y) = \sum_{ij} [P_{ij} \log(\frac{P_{ij}}{Q_{ij}}) + (1-P_{ij}) \log(\frac{1-P_{ij}}{1-Q_{ij}})]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.528em;vertical-align:-0.5423em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9857em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5073em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.528em;vertical-align:-0.5423em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9857em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5073em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)]</span></span></span></span><br>
其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 是高维空间中的相似性，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Q_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 是低维空间中的相似性。UMAP使用基于指数衰减的核函数来定义高维相似性。</li>
<li><strong>优点：</strong>
<ul>
<li>计算速度比t-SNE快得多，更适用于大数据集。</li>
<li>能更好地保留数据的全局结构，即不同簇之间的相对位置和距离通常具有生物学意义。</li>
<li>结果更稳定，受随机初始化影响较小。</li>
<li>参数更易于理解和调整（如<code>n_neighbors</code>和<code>min_dist</code>）。</li>
</ul>
</li>
<li><strong>缺点：</strong> 图像细节可能不如t-SNE那样“清晰分离”（虽然这也可能是UMAP更真实地反映了连续性）。</li>
</ul>
<h4 id="选择降维方法">选择降维方法</h4>
<ul>
<li><strong>PCA：</strong> 始终是第一步，作为后续非线性降维的输入。它去除噪音并初步降低维度。</li>
<li><strong>t-SNE：</strong> 擅长揭示局部结构，如果您的主要目标是清晰地区分细胞亚群，它可能表现出色。</li>
<li><strong>UMAP：</strong> 更推荐的方法，因为它速度更快，能更好地保留全局结构，并且结果更稳定，适合展示细胞轨迹和状态连续性。</li>
</ul>
<p><strong>示例代码（使用Seurat包在R中进行降维）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接着上一节归一化和尺度化后的pbmc对象</span></span><br><span class="line"><span class="comment"># 如果使用LogNormalize/ScaleData，确保已经执行了FindVariableFeatures和ScaleData。</span></span><br><span class="line"><span class="comment"># 如果使用SCTransform，SCTransform已经包含了ScaleData步骤。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 运行PCA</span></span><br><span class="line"><span class="comment"># 对所有高变基因进行PCA</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> RunPCA<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> features <span class="operator">=</span> VariableFeatures<span class="punctuation">(</span>pbmc<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化PCA结果</span></span><br><span class="line"><span class="comment"># DimPlot: 展示PCA结果，可以按细胞类型或其他元数据着色</span></span><br><span class="line">DimPlot<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> reduction <span class="operator">=</span> <span class="string">&quot;pca&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># VizDimLoadings: 展示每个主成分中贡献最大的基因</span></span><br><span class="line">VizDimLoadings<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> dims <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">,</span> reduction <span class="operator">=</span> <span class="string">&quot;pca&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># DimHeatmap: 热图展示每个主成分中高表达和低表达的基因</span></span><br><span class="line">DimHeatmap<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> dims <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> cells <span class="operator">=</span> <span class="number">500</span><span class="punctuation">,</span> balanced <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确定用于下游分析的主成分数量 (碎石图/Elbow Plot)</span></span><br><span class="line"><span class="comment"># 碎石图显示每个主成分解释的方差百分比。通常选择拐点之后方差贡献下降显著的PC数。</span></span><br><span class="line">ElbowPlot<span class="punctuation">(</span>pbmc<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 运行UMAP和t-SNE</span></span><br><span class="line"><span class="comment"># 在RunUMAP和RunTSNE时，n.dims参数应设置为您从PCA碎石图或其他方法确定的主成分数量。</span></span><br><span class="line"><span class="comment"># 例如，如果碎石图显示前20个主成分捕获了大部分信息，则设置dims = 1:20。</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> RunUMAP<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> dims <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">20</span><span class="punctuation">)</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> RunTSNE<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> dims <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化UMAP和t-SNE结果</span></span><br><span class="line">DimPlot<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> reduction <span class="operator">=</span> <span class="string">&quot;umap&quot;</span><span class="punctuation">)</span></span><br><span class="line">DimPlot<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> reduction <span class="operator">=</span> <span class="string">&quot;tsne&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>通过降维，我们将高维的基因表达数据转化为了直观的二维或三维散点图，图中的每个点代表一个细胞，点之间的距离反映了细胞基因表达谱的相似性。聚集在一起的点通常代表相似的细胞类型或状态，为后续的聚类分析和细胞类型鉴定奠定了基础。</p>
<hr>
<h3 id="聚类分析：识别细胞亚群">聚类分析：识别细胞亚群</h3>
<p>降维将细胞投射到了低维空间中，相似的细胞倾向于聚集在一起。**聚类分析（Clustering Analysis）**的目标就是利用这些降维后的数据，自动识别出这些紧密相关的细胞集合，从而将异质的细胞群体划分为不同的、潜在的细胞亚群。这是单细胞数据分析中最核心的步骤之一，直接关系到细胞类型的发现和后续的生物学解释。</p>
<h4 id="聚类方法">聚类方法</h4>
<p>目前，单细胞数据中最常用、表现最好的聚类方法是**基于图的聚类（Graph-based Clustering）**算法，其中以Louvain和Leiden算法最为流行。</p>
<ol>
<li>
<p><strong>构建近邻图 (Nearest Neighbor Graph)：</strong><br>
在降维后的空间（通常是PCA或UMAP空间）中，首先为每个细胞找到其最近的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个邻居（k-Nearest Neighbors, kNN）。然后，构建一个细胞-细胞图，其中每个节点代表一个细胞，边代表细胞之间的相似性（例如，它们是彼此的近邻）。边的权重可以基于细胞之间的距离或相似度。Seurat中通常构建的是<strong>共享最近邻图 (Shared Nearest Neighbor, SNN)</strong>。SNN图的边权重反映了两个细胞共享邻居的数量，这有助于区分紧密连接的簇。</p>
</li>
<li>
<p><strong>模块化优化算法 (Modularity Optimization Algorithms)：</strong><br>
一旦构建了SNN图，就可以应用图聚类算法来检测高度连接的社区（Community，即细胞簇）。</p>
<ul>
<li><strong>Louvain 算法：</strong> Louvain算法是一种贪婪优化算法，旨在最大化图的“模块化”（modularity）。模块化是一种衡量图内连接的紧密程度和图间连接的稀疏程度的指标。算法通过迭代地将节点（细胞）移动到能够最大化模块化的社区，直到收敛。</li>
<li><strong>Leiden 算法：</strong> Leiden算法是Louvain算法的改进版本。它在保证模块化优化过程中连通性的同时，避免了Louvain算法可能导致的一些不连通的社区，并且通常能够找到更高质量的社区划分，使得聚类结果更加稳定和健壮。Leiden算法通常能产生更均匀的簇，避免单个大簇包含多个真实亚群的情况。</li>
</ul>
</li>
</ol>
<h4 id="聚类分辨率-Resolution">聚类分辨率 (Resolution)</h4>
<p>聚类算法通常有一个重要的参数——<strong>分辨率（resolution）</strong>。</p>
<ul>
<li><code>resolution</code> 参数控制着聚类的“粒度”：
<ul>
<li><strong>较低的分辨率 (e.g., 0.4 - 0.7)：</strong> 会导致较少的、较大的细胞簇，通常能识别出主要的细胞类型。</li>
<li><strong>较高的分辨率 (e.g., 1.0 - 2.0)：</strong> 会导致更多的、更小的细胞簇，有助于发现细胞亚群中的进一步异质性，甚至识别出稀有细胞类型。</li>
</ul>
</li>
</ul>
<p>选择合适的分辨率是关键。通常会尝试多个分辨率，并通过检查已知标志基因的表达情况、观察聚类图、以及与实验生物学知识相结合来确定最佳分辨率。一个好的聚类结果应该使得：</p>
<ul>
<li>同一簇内的细胞具有高度相似的基因表达模式。</li>
<li>不同簇之间的基因表达模式存在显著差异。</li>
<li>已知细胞类型的标志基因在相应的簇中特异性表达。</li>
</ul>
<h4 id="评估聚类结果">评估聚类结果</h4>
<p>虽然没有一个完美的指标来评估单细胞聚类结果的“正确性”，但以下方法可以辅助评估：</p>
<ul>
<li><strong>可视化：</strong> 在UMAP/t-SNE图上直观观察聚类结果。好的聚类应该使得不同颜色的簇在空间上清晰分离。</li>
<li><strong>已知标志基因表达：</strong> 使用<code>FeaturePlot</code>或<code>DotPlot</code>可视化已知细胞类型标志基因在各个簇中的表达情况。如果一个簇特异性地高表达某种细胞类型的标志基因，则表明该簇可能代表该细胞类型。</li>
<li><strong>差异表达基因：</strong> 对每个簇进行差异表达分析，找出每个簇特有的标志基因。这些基因越特异、表达差异越大，表明聚类结果越好。</li>
<li><strong>Silhouette Score (轮廓系数)：</strong> 量化聚类内聚性和分离性，但计算成本高，且在高维稀疏数据上可能不准确。</li>
<li><strong>Adjusted Rand Index (ARI) / Normalized Mutual Information (NMI)：</strong> 如果有金标准（ground truth）的细胞标签，这些指标可以衡量聚类结果与真实标签的相似性，但在实际研究中，通常没有金标准。</li>
</ul>
<p><strong>示例代码（使用Seurat包在R中进行聚类）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接着上一节的pbmc.integrated对象 (如果进行了整合) 或 pbmc对象 (如果未进行整合)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 寻找共享最近邻 (SNN)</span></span><br><span class="line"><span class="comment"># 首先，根据PCA结果计算细胞间的欧氏距离，然后构建SNN图。</span></span><br><span class="line"><span class="comment"># k.param 参数控制了构建图时每个细胞的最近邻数量，默认为20。</span></span><br><span class="line"><span class="comment"># dims 参数指定了用于构建SNN图的主成分数量，应与RunUMAP/RunTSNE的dims参数一致。</span></span><br><span class="line">pbmc.integrated <span class="operator">&lt;-</span> FindNeighbors<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> dims <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 运行聚类算法 (Louvain或Leiden)</span></span><br><span class="line"><span class="comment"># resolution 参数控制聚类结果的粒度。</span></span><br><span class="line">pbmc.integrated <span class="operator">&lt;-</span> FindClusters<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> resolution <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="comment"># 尝试0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看识别到的细胞簇数量</span></span><br><span class="line">table<span class="punctuation">(</span>pbmc.integrated<span class="operator">@</span>active.ident<span class="punctuation">)</span> <span class="comment"># 或者 table(pbmc.integrated$seurat_clusters)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 可视化聚类结果</span></span><br><span class="line"><span class="comment"># DimPlot会根据FindClusters生成的Idents（默认是seurat_clusters）对细胞进行着色。</span></span><br><span class="line">DimPlot<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> reduction <span class="operator">=</span> <span class="string">&quot;umap&quot;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> pt.size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> NoLegend<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试不同的分辨率</span></span><br><span class="line">pbmc.integrated <span class="operator">&lt;-</span> FindClusters<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> resolution <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span> <span class="number">0.6</span><span class="punctuation">,</span> <span class="number">0.8</span><span class="punctuation">,</span> <span class="number">1.0</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以在不同的分辨率下查看聚类结果，例如resolution 0.8</span></span><br><span class="line"><span class="comment"># DimPlot(pbmc.integrated, group.by = &quot;RNA_snn_res.0.8&quot;, reduction = &quot;umap&quot;, label = TRUE) + NoLegend()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 保存当前激活的聚类结果到元数据中，以便后续操作</span></span><br><span class="line"><span class="comment"># 如果您满意某个分辨率的聚类结果，可以将其设置为默认ident</span></span><br><span class="line"><span class="comment"># pbmc.integrated@active.ident &lt;- pbmc.integrated$RNA_snn_res.0.8</span></span><br></pre></td></tr></table></figure>
<p>通过聚类分析，我们能够将庞杂的单细胞数据组织成有意义的细胞群，为后续的细胞类型鉴定和功能分析奠定了基础。下一步我们将利用这些细胞群，结合已知的生物学知识，为它们赋予生物学意义。</p>
<hr>
<h3 id="细胞类型鉴定：为细胞亚群命名">细胞类型鉴定：为细胞亚群命名</h3>
<p>通过降维和聚类，我们已经成功地将高度异质的细胞群体划分成了不同的细胞亚群。然而，这些亚群仅仅是数字标签（如Cluster 0, Cluster 1等），它们本身不具备生物学意义。**细胞类型鉴定（Cell Type Annotation）**的任务就是结合生物学知识，为这些聚类得到的细胞亚群赋予有意义的生物学名称（例如T细胞、B细胞、巨噬细胞、神经元等）。</p>
<p>细胞类型鉴定是单细胞数据分析中最为关键的一步，它将生物信息学分析结果与实际生物学功能联系起来。通常有以下几种方法：</p>
<h4 id="1-基于已知标志基因的手动鉴定-Manual-Annotation-using-Marker-Genes">1. 基于已知标志基因的手动鉴定 (Manual Annotation using Marker Genes)</h4>
<p>这是最常用且最可靠的方法。其核心思想是：每个已知的细胞类型通常都有一组特异性表达的基因，我们称之为<strong>标志基因（Marker Genes）</strong>。通过识别每个细胞簇中特异性高表达的基因，并与文献中已知的细胞类型标志基因进行比对，可以推断出该细胞簇的身份。</p>
<p><strong>流程：</strong></p>
<ol>
<li><strong>识别簇特异性标志基因：</strong> 对每个聚类得到的细胞簇，执行差异表达分析（在下一节会详细介绍），找出相对于其他所有簇或相邻簇特异性高表达的基因。这些基因是该簇的候选标志基因。
<ul>
<li>常用的函数是 <code>Seurat::FindAllMarkers</code> 或 <code>Seurat::FindMarkers</code>。</li>
</ul>
</li>
<li><strong>可视化标志基因表达：</strong> 使用<code>FeaturePlot</code>在UMAP/t-SNE图上可视化候选标志基因的表达模式。如果一个基因在某个簇中高表达，而在其他簇中表达量很低或不表达，那么它很可能是一个好的标志基因。</li>
<li><strong>结合已知生物学知识：</strong> 查阅相关的生物学文献、基因数据库（如GeneCards、Human Protein Atlas）或细胞类型数据库（如CellMarker、PanglaoDB）来验证候选标志基因是否与特定细胞类型已知相关。</li>
<li><strong>分配细胞类型名称：</strong> 根据标志基因的组合以及对生物学的理解，为每个簇分配一个最符合其特征的细胞类型名称。例如，如果一个簇高表达<code>CD3D</code>、<code>CD3E</code>、<code>CD8A</code>，则很可能是T细胞中的CD8+ T细胞。</li>
<li><strong>迭代和优化：</strong> 如果某些簇无法清晰鉴定，或者某个细胞类型分布在多个簇中，可能需要调整聚类分辨率，或重新审视过滤、归一化等前一步骤。</li>
</ol>
<p><strong>常用的细胞类型标志基因示例：</strong></p>
<ul>
<li><strong>T细胞:</strong> CD3D, CD3E, CD8A, CD4, FOXP3, NKG7</li>
<li><strong>B细胞:</strong> CD19, CD79A, MS4A1 (CD20)</li>
<li><strong>巨噬细胞/髓系细胞:</strong> CD14, LYZ, FCGR3A (CD16A), S100A8, CD68, AIF1</li>
<li><strong>NK细胞:</strong> NKG7, GNLY, KLRD1 (CD94)</li>
<li><strong>树突状细胞 (DC):</strong> FCER1A, LILRA4 (pDC), CD1C (cDC)</li>
<li><strong>成纤维细胞:</strong> COL1A1, DCN, ACTA2 (平滑肌肌动蛋白)</li>
<li><strong>上皮细胞:</strong> KRT8, EPCAM</li>
<li><strong>神经元:</strong> RBFOX3 (NEUN), SYT1</li>
<li><strong>星形胶质细胞:</strong> GFAP, AQP4</li>
<li><strong>少突胶质细胞:</strong> MBP, MOG</li>
<li><strong>内皮细胞:</strong> CDH5, PECAM1 (CD31)</li>
</ul>
<p><strong>示例代码（Seurat中进行标志基因识别和可视化）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接着上一节的pbmc.integrated对象，假设聚类结果是pbmc.integrated@active.ident</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 识别每个簇的标志基因</span></span><br><span class="line"><span class="comment"># `only.pos = TRUE` 表示只报告在当前簇中上调的基因</span></span><br><span class="line"><span class="comment"># `min.pct = 0.25` 要求基因在至少25%的细胞中表达</span></span><br><span class="line"><span class="comment"># `logfc.threshold = 0.25` 要求基因的平均表达量在当前簇中至少比其他簇高0.25倍（对数折叠变化）</span></span><br><span class="line">pbmc.markers <span class="operator">&lt;-</span> FindAllMarkers<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> only.pos <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> min.pct <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> logfc.threshold <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Cluster 0的前5个标志基因</span></span><br><span class="line">head<span class="punctuation">(</span>pbmc.markers <span class="operator">%&gt;%</span> group_by<span class="punctuation">(</span>cluster<span class="punctuation">)</span> <span class="operator">%&gt;%</span> top_n<span class="punctuation">(</span>n <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> wt <span class="operator">=</span> avg_log2FC<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 可视化关键标志基因的表达</span></span><br><span class="line"><span class="comment"># FeaturePlot: 在UMAP图上显示单个或多个基因的表达强度</span></span><br><span class="line">FeaturePlot<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> features <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;CD3D&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD14&quot;</span><span class="punctuation">,</span> <span class="string">&quot;MS4A1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD8A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FCGR3A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;GNLY&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FCER1A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD19&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            min.cutoff <span class="operator">=</span> <span class="string">&quot;q9&quot;</span><span class="punctuation">)</span> <span class="comment"># min.cutoff 可以设置显示的最低表达量，例如 q90表示90分位数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DotPlot: 点图，显示指定基因在每个簇中的表达比例和平均表达量</span></span><br><span class="line"><span class="comment"># 圈的大小表示表达该基因的细胞比例，颜色深浅表示平均表达量。</span></span><br><span class="line">DotPlot<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> features <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;CD3D&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD14&quot;</span><span class="punctuation">,</span> <span class="string">&quot;MS4A1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD8A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FCGR3A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;GNLY&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FCER1A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD19&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> cols <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> RotatedAxis<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># VlnPlot: 小提琴图，显示指定基因在每个簇中的表达分布</span></span><br><span class="line">VlnPlot<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> features <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;CD3D&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD14&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> pt.size <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 细胞类型注释 (手动修改身份)</span></span><br><span class="line"><span class="comment"># 根据标志基因，手动为每个簇命名</span></span><br><span class="line">new.cluster.ids <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;CD4 T cells&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD14 Monocytes&quot;</span><span class="punctuation">,</span> <span class="string">&quot;B cells&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD8 T cells&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FCGR3A+ Monocytes&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                     <span class="string">&quot;NK cells&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Dendritic cells&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Megakaryocytes&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Platelet&quot;</span><span class="punctuation">)</span> <span class="comment"># 举例，根据实际结果填写</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>new.cluster.ids<span class="punctuation">)</span> <span class="operator">&lt;-</span> levels<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">)</span></span><br><span class="line">pbmc.integrated <span class="operator">&lt;-</span> RenameIdents<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> new.cluster.ids<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次可视化带有新标签的UMAP图</span></span><br><span class="line">DimPlot<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> reduction <span class="operator">=</span> <span class="string">&quot;umap&quot;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> pt.size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> NoLegend<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="2-自动细胞类型注释工具-Automated-Cell-Type-Annotation">2. 自动细胞类型注释工具 (Automated Cell Type Annotation)</h4>
<p>随着单细胞数据集的规模越来越大，手动注释变得耗时且容易出错。因此，一系列自动细胞类型注释工具被开发出来，它们通常基于参考数据集或机器学习算法。</p>
<ul>
<li>
<p><strong>基于参考图谱映射 (Reference-based Mapping):</strong></p>
<ul>
<li><strong>SingleR:</strong> 基于预先定义好的参考单细胞或批量数据集（包含已知细胞类型标签）进行预测。它通过计算测试细胞与参考数据中已知细胞类型之间的相关性来分配标签。</li>
<li><strong>Cell BLAST:</strong> 借鉴了BLAST（Basic Local Alignment Search Tool）的思想，通过在基因表达空间中寻找与参考细胞最相似的细胞来推断细胞类型。</li>
<li><strong>Azimuth (Seurat v5 <code>LabelTransfer</code>):</strong> Seurat团队开发的工具，利用SCTransform归一化和整合策略，将查询数据集（query data）映射到预先构建的参考数据集（reference data）上，从而进行细胞类型注释。它在处理大规模数据集和异质性方面表现出色。</li>
</ul>
</li>
<li>
<p><strong>基于机器学习模型：</strong></p>
<ul>
<li><strong>SCINA (Single-Cell INferred Annotation):</strong> 基于用户提供的标志基因列表，使用一个基于统计学的算法来识别细胞类型。</li>
<li><strong>Garnett:</strong> 使用随机森林分类器，需要提供带有标签的训练数据。</li>
<li><strong>CellAssign:</strong> 使用概率模型，将细胞分配到其最有可能的细胞类型。</li>
</ul>
</li>
</ul>
<p><strong>优点：</strong> 自动化、效率高，在处理大型数据集时尤其有用。<br>
<strong>缺点：</strong> 依赖于参考数据集的质量和完整性。如果您的数据集中包含参考数据集中没有的稀有细胞类型，或者细胞状态与参考数据集差异较大，自动注释可能会不准确。通常仍需要手动验证和调整。</p>
<p><strong>示例（使用Azimuth / LabelTransfer）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install.packages(&quot;remotes&quot;)</span></span><br><span class="line"><span class="comment"># remotes::install_github(&quot;satijalab/seurat-data&quot;)</span></span><br><span class="line"><span class="comment"># install.packages(&quot;SeuratData&quot;)</span></span><br><span class="line"><span class="comment"># SeuratData::InstallData(&quot;pbmc3k.reference&quot;) # 安装参考数据集</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>SeuratData<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;pbmc3k.reference&quot;</span><span class="punctuation">)</span> <span class="comment"># 加载预训练的PBMC参考数据集</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设pbmc是您需要注释的Seurat对象，已经经过SCTransform归一化</span></span><br><span class="line"><span class="comment"># 如果没有SCTransform，需要先运行：pbmc &lt;- SCTransform(pbmc)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 寻找锚点并进行标签转移</span></span><br><span class="line">anchors_label <span class="operator">&lt;-</span> FindTransferAnchors<span class="punctuation">(</span>reference <span class="operator">=</span> pbmc3k.reference<span class="punctuation">,</span> query <span class="operator">=</span> pbmc<span class="punctuation">,</span> </span><br><span class="line">                                     dims <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">30</span><span class="punctuation">,</span> reference.reduction <span class="operator">=</span> <span class="string">&quot;pca&quot;</span><span class="punctuation">)</span> <span class="comment"># 确保reference.reduction与参考数据匹配</span></span><br><span class="line"></span><br><span class="line">predictions <span class="operator">&lt;-</span> TransferData<span class="punctuation">(</span>anchorset <span class="operator">=</span> anchors_label<span class="punctuation">,</span> refdata <span class="operator">=</span> pbmc3k.reference<span class="operator">$</span>celltype.l2<span class="punctuation">,</span> </span><br><span class="line">                            dims <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">30</span><span class="punctuation">,</span> query <span class="operator">=</span> pbmc<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将预测结果添加到Seurat对象</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> AddMetaData<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> metadata <span class="operator">=</span> predictions<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化预测的细胞类型</span></span><br><span class="line">DimPlot<span class="punctuation">(</span>pbmc<span class="punctuation">,</span> group.by <span class="operator">=</span> <span class="string">&quot;predicted.id&quot;</span><span class="punctuation">,</span> reduction <span class="operator">=</span> <span class="string">&quot;umap&quot;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> repel <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span> NoLegend<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="3-结合流式细胞术数据或空间转录组学数据">3. 结合流式细胞术数据或空间转录组学数据</h4>
<ul>
<li><strong>流式细胞术 (Flow Cytometry) / 质谱流式 (Mass Cytometry, CyTOF)：</strong> 这些技术可以提供细胞表面蛋白的表达信息，与单细胞RNA-seq数据进行整合（如CITE-seq）可以更精确地鉴定细胞类型，因为蛋白质表达通常比mRNA表达更稳定、更直接地反映细胞功能。</li>
<li><strong>空间转录组学 (Spatial Transcriptomics):</strong> 结合单细胞数据和空间信息，可以将单细胞数据中的细胞类型映射回组织原位，从而验证细胞类型并理解其在组织中的空间分布和功能。</li>
</ul>
<p>在实际分析中，通常会结合手动鉴定和自动注释，以确保细胞类型鉴定的准确性和可靠性。手动检查关键标志基因，并结合生物学背景知识，是不可或缺的一步。最终，我们将得到一个带有明确细胞类型标签的单细胞数据集，为后续深入的生物学问题探索提供了基础。</p>
<hr>
<h3 id="差异表达分析：揭示细胞类型间的基因表达差异">差异表达分析：揭示细胞类型间的基因表达差异</h3>
<p>在成功鉴定出细胞类型后，我们最感兴趣的问题之一就是：不同细胞类型之间，或者同一细胞类型在不同处理条件下的细胞之间，哪些基因的表达量存在显著差异？**差异表达分析（Differential Expression Analysis, DEA）**正是回答这个问题的关键步骤。通过DEA，我们可以识别每个细胞类型特有的标志基因，或者发现疾病状态下细胞特异性的基因表达变化，从而揭示潜在的分子机制和生物学功能。</p>
<h4 id="单细胞差异表达分析的挑战">单细胞差异表达分析的挑战</h4>
<p>与批量RNA-seq不同，单细胞数据的稀疏性（大量零值）和高变异性给差异表达分析带来了特有的挑战：</p>
<ol>
<li><strong>零膨胀 (Zero Inflation)：</strong> 大量的零值使得传统的基于连续分布的统计模型不适用。</li>
<li><strong>异质性 (Heterogeneity)：</strong> 即使是同一细胞类型内部，也可能存在显著的异质性，增加了噪音。</li>
<li><strong>小样本量：</strong> 尽管总细胞数很多，但每个细胞类型内的细胞数可能相对较少。</li>
</ol>
<p>为了应对这些挑战，许多专门为单细胞数据设计的差异表达分析方法被开发出来。</p>
<h4 id="常用差异表达分析方法">常用差异表达分析方法</h4>
<ol>
<li>
<p><strong>Wilcoxon Rank Sum Test (或Mann-Whitney U Test):</strong><br>
这是Seurat中默认的非参数检验方法，也是最常用的方法之一。</p>
<ul>
<li><strong>原理：</strong> 它比较两个细胞群中某个基因的表达量排序。它不假设数据遵循特定的分布，对异常值不敏感，且能很好地处理零值。对于每个基因，它比较一个细胞群中该基因的表达值（通常是归一化后的对数表达值）的秩，与另一个细胞群中该基因的表达值的秩。</li>
<li><strong>优点：</strong> 简单、鲁棒、计算速度快。</li>
<li><strong>缺点：</strong> 无法区分“真正的零”（基因不表达）和“技术性零”（掉线），可能高估一些基因的差异性。</li>
</ul>
</li>
<li>
<p><strong>MAST (Model-based Analysis of Single Cell Transcriptomics):</strong><br>
MAST是一个基于广义线性模型（Generalized Linear Model, GLM）的框架，专门用于单细胞数据。</p>
<ul>
<li><strong>原理：</strong> MAST使用“两部分”模型来解释单细胞数据的特点。它首先建立一个逻辑回归模型来模拟基因表达的“开/关”状态（即是否有检测到表达），然后对于表达的细胞，再建立一个高斯模型（或其它分布）来模拟其表达量。这有助于区分真正的零表达和掉线事件。</li>
<li><strong>优点：</strong> 能更好地处理零膨胀问题，更准确地估计差异表达。</li>
<li><strong>缺点：</strong> 计算相对较慢，对计算资源有一定要求。</li>
</ul>
</li>
<li>
<p><strong>DESeq2 / edgeR (适用于伪批量分析或经调整后)：</strong><br>
这些是传统的批量RNA-seq差异表达分析的黄金标准工具，基于负二项分布模型。</p>
<ul>
<li><strong>在单细胞中的应用：</strong> 通常不直接应用于单个细胞，而是通过“伪批量”（Pseudobulk）分析，即将同一细胞类型中的细胞计数汇总成一个“伪样本”，然后对伪样本进行DESeq2或edgeR分析。</li>
<li><strong>优点：</strong> 充分利用了这些包在处理计数数据和控制假阳性方面的优势。</li>
<li><strong>缺点：</strong> 损失了单细胞分辨率的特有信息，无法捕捉细胞内的异质性。</li>
</ul>
</li>
<li>
<p><strong>Limma (适用于连续表达值数据)：</strong><br>
如果数据经过了SCTransform等方法处理，使得表达值更接近正态分布，或者进行的是基于残差的分析，可以考虑使用Limma。</p>
</li>
</ol>
<h4 id="差异表达结果的解读与可视化">差异表达结果的解读与可视化</h4>
<p>DEA的结果通常是一个表格，包含每个基因的：</p>
<ul>
<li><strong>Log2 Fold Change (log2FC):</strong> 基因在两个比较组之间的平均表达量倍数变化（对数形式）。</li>
<li><strong>P值 (p-value):</strong> 统计显著性水平，表示观察到的差异是由于随机波动的概率。</li>
<li><strong>调整P值 (Adjusted p-value / FDR):</strong> 经过多重检验校正后的P值，用于控制假阳性率（False Discovery Rate, FDR）。通常使用Benjamini-Hochberg (BH) 方法。通常要求调整P值小于0.05。</li>
</ul>
<p><strong>可视化方法：</strong></p>
<ul>
<li><strong>火山图 (Volcano Plot):</strong> 展示log2FC和调整P值，快速识别显著差异表达基因。</li>
<li><strong>热图 (Heatmap):</strong> 展示多个基因在不同细胞类型或条件下的表达模式，能直观地看到基因在不同簇中的表达特异性。</li>
<li><strong>小提琴图 (VlnPlot) / 散点图 (DotPlot):</strong> 展示特定基因在不同细胞群中的表达分布。</li>
</ul>
<h4 id="富集分析-Enrichment-Analysis">富集分析 (Enrichment Analysis)</h4>
<p>获得差异表达基因列表后，下一步通常是进行<strong>基因本体（Gene Ontology, GO）富集分析</strong>和<strong>京都基因与基因组百科全书（KEGG）通路富集分析</strong>。</p>
<ul>
<li><strong>目的：</strong> 识别这些差异表达基因是否在特定的生物学过程、分子功能或细胞组分中显著富集，或者富集在特定的信号通路中。这有助于我们从基因层面上升到功能层面，理解细胞类型特异性的生物学功能或状态变化。</li>
<li><strong>常用工具：</strong>
<ul>
<li><strong>clusterProfiler ®:</strong> 功能强大的富集分析包。</li>
<li><strong>DAVID:</strong> 在线工具，易于使用。</li>
<li><strong>Metascape:</strong> 另一个全面的在线富集分析平台。</li>
<li><strong>GSEA (Gene Set Enrichment Analysis):</strong> 不仅关注差异表达基因的列表，而是关注整个基因集合的趋势，能发现微弱但一致的信号。</li>
</ul>
</li>
</ul>
<p><strong>示例代码（使用Seurat包在R中进行差异表达分析）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接着上一步已经鉴定好细胞类型的pbmc.integrated对象</span></span><br><span class="line"><span class="comment"># 假设您已经重命名了Idents，例如：</span></span><br><span class="line"><span class="comment"># pbmc.integrated@active.ident &lt;- pbmc.integrated$celltype_annotations # 假设celltype_annotations是您新的元数据列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 寻找每个簇相对于所有其他簇的标志基因</span></span><br><span class="line"><span class="comment"># 这是最常用的方法，用于识别每个细胞类型的特征基因</span></span><br><span class="line">cluster.markers <span class="operator">&lt;-</span> FindAllMarkers<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> only.pos <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> min.pct <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> logfc.threshold <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看并保存结果</span></span><br><span class="line">write.csv<span class="punctuation">(</span>cluster.markers<span class="punctuation">,</span> file <span class="operator">=</span> <span class="string">&quot;cluster_marker_genes.csv&quot;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 筛选并显示每个簇的前N个标志基因</span></span><br><span class="line">top_n_markers <span class="operator">&lt;-</span> cluster.markers <span class="operator">%&gt;%</span> </span><br><span class="line">  group_by<span class="punctuation">(</span>cluster<span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  top_n<span class="punctuation">(</span>n <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> wt <span class="operator">=</span> avg_log2FC<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 比较两个特定细胞群之间的差异表达基因</span></span><br><span class="line"><span class="comment"># 示例：比较“CD4 T cells”和“CD8 T cells”之间的差异表达</span></span><br><span class="line">CD4_vs_CD8_markers <span class="operator">&lt;-</span> FindMarkers<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> </span><br><span class="line">                                  ident.1 <span class="operator">=</span> <span class="string">&quot;CD4 T cells&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                                  ident.2 <span class="operator">=</span> <span class="string">&quot;CD8 T cells&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                                  min.pct <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> logfc.threshold <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">head<span class="punctuation">(</span>CD4_vs_CD8_markers<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 可视化差异表达基因</span></span><br><span class="line"><span class="comment"># 热图：展示顶级标志基因在所有细胞群中的表达模式</span></span><br><span class="line"><span class="comment"># 首先选择一些有代表性的标志基因</span></span><br><span class="line"><span class="comment"># 例如，从cluster.markers中挑选每个簇的前2-3个基因</span></span><br><span class="line">top_genes_for_heatmap <span class="operator">&lt;-</span> cluster.markers <span class="operator">%&gt;%</span> </span><br><span class="line">  group_by<span class="punctuation">(</span>cluster<span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  top_n<span class="punctuation">(</span>n <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> wt <span class="operator">=</span> avg_log2FC<span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  pull<span class="punctuation">(</span>gene<span class="punctuation">)</span> <span class="operator">%&gt;%</span> unique<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">DoHeatmap<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> features <span class="operator">=</span> top_genes_for_heatmap<span class="punctuation">,</span> group.by <span class="operator">=</span> <span class="string">&quot;ident&quot;</span><span class="punctuation">,</span> cells <span class="operator">=</span> sample<span class="punctuation">(</span>colnames<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">500</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> NoLegend<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 小提琴图展示特定基因的表达差异</span></span><br><span class="line">VlnPlot<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> features <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;CD4&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CD8A&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> group.by <span class="operator">=</span> <span class="string">&quot;ident&quot;</span><span class="punctuation">,</span> pt.size <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FeaturePlot展示基因在UMAP图上的表达</span></span><br><span class="line">FeaturePlot<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> features <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;CCR7&quot;</span><span class="punctuation">,</span> <span class="string">&quot;SELL&quot;</span><span class="punctuation">,</span> <span class="string">&quot;GZMB&quot;</span><span class="punctuation">,</span> <span class="string">&quot;PRF1&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            reduction <span class="operator">=</span> <span class="string">&quot;umap&quot;</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> min.cutoff <span class="operator">=</span> <span class="string">&quot;q9&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 富集分析 (使用clusterProfiler示例)</span></span><br><span class="line"><span class="comment"># install.packages(&quot;BiocManager&quot;)</span></span><br><span class="line"><span class="comment"># BiocManager::install(&quot;clusterProfiler&quot;)</span></span><br><span class="line"><span class="comment"># BiocManager::install(&quot;org.Hs.eg.db&quot;) # 如果是人类基因，安装人类基因注释包</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>clusterProfiler<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>org.Hs.eg.db<span class="punctuation">)</span> <span class="comment"># 适用于人，其他物种需要安装对应的org.db包</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设我们对Cluster 0（CD4 T cells）的标志基因进行富集分析</span></span><br><span class="line"><span class="comment"># 获取Cluster 0的差异表达基因（显著上调的）</span></span><br><span class="line">cluster0_genes <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>cluster.markers<span class="punctuation">,</span> cluster <span class="operator">==</span> <span class="string">&quot;CD4 T cells&quot;</span> <span class="operator">&amp;</span> p_val_adj <span class="operator">&lt;</span> <span class="number">0.05</span> <span class="operator">&amp;</span> avg_log2FC <span class="operator">&gt;</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="operator">$</span>gene</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将基因符号转换为Entrez ID (富集分析通常需要Entrez ID)</span></span><br><span class="line">entrez_ids <span class="operator">&lt;-</span> bitr<span class="punctuation">(</span>cluster0_genes<span class="punctuation">,</span> fromType<span class="operator">=</span><span class="string">&quot;SYMBOL&quot;</span><span class="punctuation">,</span> toType<span class="operator">=</span><span class="string">&quot;ENTREZID&quot;</span><span class="punctuation">,</span> OrgDb<span class="operator">=</span><span class="string">&quot;org.Hs.eg.db&quot;</span><span class="punctuation">)</span></span><br><span class="line">entrez_ids_vec <span class="operator">&lt;-</span> entrez_ids<span class="operator">$</span>ENTREZID</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进行GO富集分析</span></span><br><span class="line">ego <span class="operator">&lt;-</span> enrichGO<span class="punctuation">(</span>gene          <span class="operator">=</span> entrez_ids_vec<span class="punctuation">,</span></span><br><span class="line">                OrgDb         <span class="operator">=</span> org.Hs.eg.db<span class="punctuation">,</span></span><br><span class="line">                keyType       <span class="operator">=</span> <span class="string">&#x27;ENTREZID&#x27;</span><span class="punctuation">,</span></span><br><span class="line">                ont           <span class="operator">=</span> <span class="string">&quot;BP&quot;</span><span class="punctuation">,</span> <span class="comment"># Biological Process</span></span><br><span class="line">                pAdjustMethod <span class="operator">=</span> <span class="string">&quot;BH&quot;</span><span class="punctuation">,</span></span><br><span class="line">                qvalueCutoff  <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>ego<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 可视化富集结果</span></span><br><span class="line">dotplot<span class="punctuation">(</span>ego<span class="punctuation">,</span> showCategory<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进行KEGG富集分析</span></span><br><span class="line">kegg <span class="operator">&lt;-</span> enrichKEGG<span class="punctuation">(</span>gene         <span class="operator">=</span> entrez_ids_vec<span class="punctuation">,</span></span><br><span class="line">                   organism     <span class="operator">=</span> <span class="string">&#x27;hsa&#x27;</span><span class="punctuation">,</span> <span class="comment"># 人类是 &#x27;hsa&#x27;</span></span><br><span class="line">                   pvalueCutoff <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>kegg<span class="punctuation">)</span></span><br><span class="line">dotplot<span class="punctuation">(</span>kegg<span class="punctuation">,</span> showCategory<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>差异表达分析是单细胞数据分析的“金矿”。通过这一步，我们将数据层面的差异转化为生物学功能上的洞察，为后续的实验验证和机制研究提供了重要的线索。</p>
<hr>
<h3 id="轨迹推断：追踪细胞状态的连续演变">轨迹推断：追踪细胞状态的连续演变</h3>
<p>在许多生物学过程中，细胞状态并不是离散的，而是连续变化的。例如，干细胞的分化、免疫细胞的激活、疾病进展中的细胞状态转变等。传统的聚类分析将细胞划分为离散的群体，这虽然有助于识别主要细胞类型，但往往无法捕捉这些连续的、动态的生物学过程。<strong>轨迹推断（Trajectory Inference）</strong>，也称为<strong>拟时序分析（Pseudotime Analysis）</strong>，应运而生，其目标是根据基因表达谱的相似性，将细胞排列在一个连续的“伪时间”（Pseudotime）轴上，从而重构细胞分化或状态转变的动态路径。</p>
<h4 id="拟时序与真实时间">拟时序与真实时间</h4>
<p>“拟时序”是一个基于基因表达相似性的抽象时间概念。它与细胞在生物体内的真实时间或发育时间并不完全等同，但通常与真实的生物学过程高度相关。拟时序的起点通常是处于起始状态的细胞（如干细胞），而终点则是分化完全的细胞（如终末分化细胞）。</p>
<h4 id="轨迹推断的基本原理">轨迹推断的基本原理</h4>
<p>大多数轨迹推断算法都基于以下几个核心思想：</p>
<ol>
<li><strong>降维与流形学习：</strong> 假设细胞状态的连续变化轨迹位于一个低维的非线性流形上。算法首先将高维基因表达数据降维到2D或3D空间，同时保留细胞之间的局部和全局相似性。</li>
<li><strong>构建最小生成树或弹性图：</strong> 在降维后的空间中，通过连接细胞或细胞群的中心，构建一个图结构（例如最小生成树MST，或弹性图Elastic Principal Graph），来表示细胞状态的连续路径。图中的节点代表细胞或细胞群，边代表细胞状态的转换。</li>
<li><strong>拟时序排序：</strong> 选择一个起始细胞或起始细胞群，然后沿着构建的轨迹图计算每个细胞到起始点的“距离”，将这个距离定义为拟时序。距离越远，拟时序值越大。</li>
</ol>
<h4 id="常用轨迹推断工具">常用轨迹推断工具</h4>
<p>目前有几十种不同的轨迹推断工具，每种工具都有其独特的算法和适用场景。以下是一些最流行和广泛使用的工具：</p>
<ol>
<li>
<p><strong>Monocle (Monocle2 / Monocle3):</strong></p>
<ul>
<li><strong>Monocle2 ®:</strong> 经典的轨迹推断工具，适用于识别简单的分叉或分支结构。它使用DDRTree（Discriminative Dimensionality Reduction Tree）算法进行降维和图构建。</li>
<li><strong>Monocle3 ®:</strong> Monocle的升级版，支持更大规模的数据集，能够处理更复杂的轨迹结构，如循环和多个起始/终止点。它使用UMAP进行降维，并基于<code>igraph</code>构建图。</li>
<li><strong>原理：</strong> 首先识别高变基因，然后使用降维算法（如DDRTree或UMAP）将细胞投影到低维空间，并在该空间中构建一个弹性主图（Elastic Principal Graph），拟合数据的主要路径。最后，通过在图上测量到起始点的距离来分配拟时序值。</li>
<li><strong>核心步骤：</strong>
<ol>
<li>数据准备（创建<code>CellDataSet</code>对象）。</li>
<li>识别伪时序基因。</li>
<li>降维和拟合轨迹。</li>
<li>对细胞进行拟时序排序。</li>
<li>可视化基因在拟时序上的表达变化。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>PAGA (Partition-based graph abstraction, Scanpy / Python):</strong></p>
<ul>
<li><strong>原理：</strong> PAGA是Scanpy（Python）中的一个模块，它首先对细胞进行聚类，然后构建一个抽象的图，其中每个节点代表一个细胞簇，边表示簇之间存在连接（即它们之间有共同的细胞）。PAGA通过计算不同簇之间连接的统计显著性来推断连通性，从而更好地保留全局拓扑结构。</li>
<li><strong>优点：</strong> 能够清晰地可视化细胞群之间的连通性和潜在的分化路径，特别适合探索复杂的拓扑结构。</li>
<li><strong>缺点：</strong> 结果是基于簇的抽象图，而不是每个细胞的精确拟时序。</li>
</ul>
</li>
<li>
<p><strong>Slingshot ®:</strong></p>
<ul>
<li><strong>原理：</strong> Slingshot是一个相对简单但有效的工具。它首先需要用户提供预先聚类好的细胞群。然后，它使用主曲线（Principal Curves）或MST（Minimum Spanning Tree）来连接这些聚类中心，推断出细胞分化的主要轨迹。</li>
<li><strong>优点：</strong> 易于使用，能处理线性或分叉轨迹，并能直接在UMAP/t-SNE图上叠加轨迹。</li>
<li><strong>缺点：</strong> 依赖于良好的预聚类结果。</li>
</ul>
</li>
<li>
<p><strong>RNA Velocity (Velocyto / scVelo):</strong></p>
<ul>
<li><strong>原理：</strong> RNA Velocity是一种独特的轨迹推断方法，它不依赖于拟时序，而是通过测量细胞中未剪接（Unspliced）和已剪接（Spliced）mRNA的比率来直接推断基因表达变化的瞬时方向和速度。未剪接RNA是刚转录出来的，代表未来趋势；已剪接RNA是即将被翻译的，代表当前状态。这种方法能够预测细胞在基因表达空间中的“未来”状态。</li>
<li><strong>优点：</strong> 提供细胞状态变化的真实方向，具有更高的预测性。</li>
<li><strong>缺点：</strong> 对数据质量要求较高，需要额外处理，目前主要在Python中实现。</li>
</ul>
</li>
</ol>
<h4 id="轨迹推断的应用">轨迹推断的应用</h4>
<ul>
<li><strong>识别分化路径：</strong> 追踪干细胞向不同终末细胞类型分化的过程。</li>
<li><strong>揭示细胞状态转变的连续性：</strong> 例如，免疫细胞在激活过程中的连续变化。</li>
<li><strong>发现驱动细胞命运决定的关键基因：</strong> 识别在拟时序上表达量发生显著变化的基因，这些基因可能在细胞分化或状态转变中发挥关键作用。</li>
<li><strong>探索疾病进展中的细胞动态：</strong> 理解疾病如何导致细胞从一种状态转变为另一种状态。</li>
</ul>
<p><strong>示例代码（使用Monocle3进行轨迹推断）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install.packages(&quot;BiocManager&quot;)</span></span><br><span class="line"><span class="comment"># BiocManager::install(c(&quot;BiocGenerics&quot;, &quot;DelayedArray&quot;, &quot;DelayedMatrixStats&quot;,</span></span><br><span class="line"><span class="comment">#                       &quot;limma&quot;, &quot;lme4&quot;, &quot;S4Vectors&quot;, &quot;SingleCellExperiment&quot;,</span></span><br><span class="line"><span class="comment">#                       &quot;SummarizedExperiment&quot;, &quot;sparseMatrixStats&quot;,</span></span><br><span class="line"><span class="comment">#                       &quot;devtools&quot;))</span></span><br><span class="line"><span class="comment"># devtools::install_github(&#x27;cole-trapnell-lab/monocle3&#x27;)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>monocle3<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>Seurat<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 准备数据：将Seurat对象转换为CellDataSet对象 (Monocle3)</span></span><br><span class="line"><span class="comment"># 注意：Monocle3需要原始计数数据，所以我们从Seurat对象的 &#x27;counts&#x27; assay中提取</span></span><br><span class="line"><span class="comment"># 以及归一化后的数据 (通常是LogNormalize后的数据)</span></span><br><span class="line"><span class="comment"># 和细胞元数据 (cell_metadata)</span></span><br><span class="line"><span class="comment"># 和基因元数据 (gene_annotation)</span></span><br><span class="line"></span><br><span class="line">expression_matrix <span class="operator">&lt;-</span> GetAssayData<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> slot <span class="operator">=</span> <span class="string">&quot;counts&quot;</span><span class="punctuation">)</span></span><br><span class="line">cell_metadata <span class="operator">&lt;-</span> pbmc.integrated<span class="operator">@</span>meta.data</span><br><span class="line">gene_annotation <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>gene_short_name <span class="operator">=</span> rownames<span class="punctuation">(</span>expression_matrix<span class="punctuation">)</span><span class="punctuation">,</span> row.names <span class="operator">=</span> rownames<span class="punctuation">(</span>expression_matrix<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个新的CellDataSet对象</span></span><br><span class="line">cds <span class="operator">&lt;-</span> new_cell_data_set<span class="punctuation">(</span>expression_matrix<span class="punctuation">,</span></span><br><span class="line">                         cell_metadata <span class="operator">=</span> cell_metadata<span class="punctuation">,</span></span><br><span class="line">                         gene_metadata <span class="operator">=</span> gene_annotation<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 预处理数据 (Monocle3 的独立处理流程)</span></span><br><span class="line"><span class="comment"># Monocle3通常建议使用自己的归一化和降维</span></span><br><span class="line">cds <span class="operator">&lt;-</span> preprocess_cds<span class="punctuation">(</span>cds<span class="punctuation">,</span> num_dim <span class="operator">=</span> <span class="number">100</span><span class="punctuation">)</span> <span class="comment"># 可以指定用于PCA的维度</span></span><br><span class="line">cds <span class="operator">&lt;-</span> align_cds<span class="punctuation">(</span>cds<span class="punctuation">,</span> alignment_group <span class="operator">=</span> <span class="string">&quot;orig.ident&quot;</span><span class="punctuation">)</span> <span class="comment"># 如果有批次效应，可以使用此步校正</span></span><br><span class="line">cds <span class="operator">&lt;-</span> reduce_dimension<span class="punctuation">(</span>cds<span class="punctuation">,</span> reduction_method <span class="operator">=</span> <span class="string">&quot;UMAP&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将Seurat的UMAP嵌入信息转移到Monocle3 (可选，如果想保持一致性)</span></span><br><span class="line"><span class="comment"># cds@int_colData@listData$reducedDims$UMAP &lt;- pbmc.integrated@reductions$umap@cell.embeddings</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 聚类细胞 (如果Seurat已经聚类，Monocle3可以导入，也可以自己再聚类)</span></span><br><span class="line">cds <span class="operator">&lt;-</span> cluster_cells<span class="punctuation">(</span>cds<span class="punctuation">,</span> resolution <span class="operator">=</span> <span class="number">1e-2</span><span class="punctuation">)</span> <span class="comment"># Monocle3的resolution参数与Seurat不同，通常很小</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化聚类结果</span></span><br><span class="line">plot_cells<span class="punctuation">(</span>cds<span class="punctuation">,</span> color_cells_by <span class="operator">=</span> <span class="string">&quot;partition&quot;</span><span class="punctuation">,</span> group_cells_by <span class="operator">=</span> <span class="string">&quot;partition&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot_cells<span class="punctuation">(</span>cds<span class="punctuation">,</span> color_cells_by <span class="operator">=</span> <span class="string">&quot;seurat_clusters&quot;</span><span class="punctuation">,</span> label_groups_by_cluster <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">           label_leaves <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> label_branch_points <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> graph_label_size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 学习轨迹 (Learning the trajectory)</span></span><br><span class="line">cds <span class="operator">&lt;-</span> learn_graph<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化学习到的轨迹</span></span><br><span class="line">plot_cells<span class="punctuation">(</span>cds<span class="punctuation">,</span></span><br><span class="line">           color_cells_by <span class="operator">=</span> <span class="string">&quot;seurat_clusters&quot;</span><span class="punctuation">,</span></span><br><span class="line">           label_groups_by_cluster <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">           label_leaves <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">           label_branch_points <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">           graph_label_size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 分配拟时序 (Order cells in pseudotime)</span></span><br><span class="line"><span class="comment"># 选择一个或多个起始节点，这通常需要基于生物学知识或前期聚类分析。</span></span><br><span class="line"><span class="comment"># 这里我们选择Cluster 0 (假设是起始细胞群) 作为起始点</span></span><br><span class="line">cds <span class="operator">&lt;-</span> order_cells<span class="punctuation">(</span>cds<span class="punctuation">,</span> root_cells <span class="operator">=</span> colnames<span class="punctuation">(</span>cds<span class="punctuation">[</span><span class="punctuation">,</span> clusters<span class="punctuation">(</span>cds<span class="punctuation">)</span> <span class="operator">==</span> <span class="string">&quot;0&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 假设Cluster 0是起始簇</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化细胞的拟时序</span></span><br><span class="line">plot_cells<span class="punctuation">(</span>cds<span class="punctuation">,</span></span><br><span class="line">           color_cells_by <span class="operator">=</span> <span class="string">&quot;pseudotime&quot;</span><span class="punctuation">,</span></span><br><span class="line">           label_cell_groups <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">           label_leaves <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">           label_branch_points <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">           graph_label_size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 找出在拟时序上变化的基因</span></span><br><span class="line"><span class="comment"># graph_test 识别与轨迹关联的基因</span></span><br><span class="line">gene_fits <span class="operator">&lt;-</span> graph_test<span class="punctuation">(</span>cds<span class="punctuation">,</span> neighbor_graph <span class="operator">=</span> <span class="string">&quot;principal_graph&quot;</span><span class="punctuation">,</span> cores <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">top_pseudo_genes <span class="operator">&lt;-</span> gene_fits <span class="operator">%&gt;%</span> </span><br><span class="line">  arrange<span class="punctuation">(</span>q_value<span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  head<span class="punctuation">(</span>num <span class="operator">=</span> <span class="number">100</span><span class="punctuation">)</span> <span class="comment"># 查看前100个显著变化的基因</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化特定基因在拟时序上的表达变化</span></span><br><span class="line">plot_genes_in_pseudotime<span class="punctuation">(</span>cds<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;CCR7&quot;</span><span class="punctuation">,</span> <span class="string">&quot;SELL&quot;</span><span class="punctuation">,</span> <span class="string">&quot;GZMB&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                         color_cells_by <span class="operator">=</span> <span class="string">&quot;seurat_clusters&quot;</span><span class="punctuation">,</span></span><br><span class="line">                         min_expr <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>轨迹推断打开了探索细胞动态过程的大门，它使我们能够从静态的细胞“快照”中，推导出细胞分化和状态转变的连续图景，为理解复杂生物学过程提供了新的视角。</p>
<hr>
<h3 id="细胞-细胞通讯分析：解码细胞间的对话">细胞-细胞通讯分析：解码细胞间的对话</h3>
<p>在多细胞生物体中，细胞并非孤立存在，它们通过分泌信号分子（配体）与靶细胞上的受体结合，进行复杂的相互交流。这种**细胞-细胞通讯（Cell-Cell Communication）**是维持组织稳态、协调生理功能以及介导疾病发生发展（如免疫反应、肿瘤微环境）的关键。单细胞转录组数据提供了前所未有的机会来推断不同细胞类型之间潜在的相互作用网络。</p>
<h4 id="基本原理">基本原理</h4>
<p>细胞-细胞通讯分析的核心思想是基于配体-受体（Ligand-Receptor, L-R）相互作用数据库。这些数据库整合了已知的配体基因及其对应的受体基因。通过分析不同细胞类型中配体和受体基因的表达模式，我们可以推断出哪些细胞类型可能充当信号发送者（表达配体），哪些细胞类型可能充当信号接收者（表达受体），从而构建潜在的通讯网络。</p>
<p><strong>分析流程大致包括：</strong></p>
<ol>
<li><strong>加载数据和配体-受体数据库：</strong> 通常需要提供一个归一化后的单细胞表达矩阵和细胞类型注释信息，以及一个预先构建好的配体-受体对数据库。</li>
<li><strong>配体和受体表达量计算：</strong> 对于每个细胞类型，计算其内部所有细胞中配体和受体基因的平均表达量或表达比例。</li>
<li><strong>预测相互作用：</strong> 遍历所有可能的细胞类型组合（发送者-接收者），检查发送者细胞类型是否表达配体，以及接收者细胞类型是否表达对应的受体。通常会设置一个表达量阈值。</li>
<li><strong>统计显著性评估：</strong> 采用置换检验（Permutation Test）等统计方法，评估观察到的配体-受体对共表达的显著性，以排除随机共表达的可能性。例如，随机打乱细胞标签，重复计算，并与真实数据进行比较。</li>
<li><strong>可视化结果：</strong> 以网络图、热图或弦图等形式，直观地展示细胞间通讯的强度和方向。</li>
</ol>
<h4 id="常用细胞-细胞通讯分析工具">常用细胞-细胞通讯分析工具</h4>
<p>目前有多种工具用于推断单细胞通讯，各有优缺点：</p>
<ol>
<li>
<p><strong>CellPhoneDB：</strong></p>
<ul>
<li><strong>特点：</strong> 最早且最广泛使用的工具之一。它拥有一个全面的配体-受体数据库（包括复杂的受体复合体），并能够对相互作用的显著性进行统计检验。</li>
<li><strong>原理：</strong> 对于每个配体-受体对，CellPhoneDB会计算所有可能的细胞类型组合中，配体和受体基因的平均表达量，然后进行置换检验来评估其显著性。它特别擅长处理由多个亚基组成的受体复合体。</li>
<li><strong>输出：</strong> 生成一个显著性P值矩阵和平均表达量矩阵，以及一个包含所有预测相互作用的详细表格。</li>
</ul>
</li>
<li>
<p><strong>CellChat：</strong></p>
<ul>
<li><strong>特点：</strong> 一个功能强大且用户友好的R包，提供了更全面的细胞通讯分析框架，包括推断信号路径、识别关键发送者/接收者细胞、以及对不同条件下通讯网络的比较。</li>
<li><strong>原理：</strong> CellChat不仅考虑配体-受体对，还整合了信号通路信息，能够推断上游信号通路激活。它使用了一个更复杂的L-R数据库，并引入了“通讯概率”的概念，可以识别主导通讯的信号通路。</li>
<li><strong>输出：</strong> 提供丰富的可视化选项，包括网络图、通路热图、弦图，以及对通讯强度和模式的量化。</li>
</ul>
</li>
<li>
<p><strong>NICHES (Inferring Intercellular Interaction Networks from Single-Cell Data):</strong></p>
<ul>
<li><strong>特点：</strong> 另一个R包，专注于识别细胞间的直接和间接相互作用，包括旁分泌、自分泌等模式。</li>
</ul>
</li>
<li>
<p><strong>Connectome：</strong></p>
<ul>
<li><strong>特点：</strong> 致力于从单细胞数据中重建细胞间连接网络。</li>
</ul>
</li>
</ol>
<h4 id="细胞-细胞通讯分析的应用">细胞-细胞通讯分析的应用</h4>
<ul>
<li><strong>理解组织微环境：</strong> 揭示免疫细胞、肿瘤细胞、基质细胞等在肿瘤、炎症、发育等过程中的相互作用。</li>
<li><strong>识别关键信号通路：</strong> 找出在特定生物学背景下，介导细胞间通讯的关键配体-受体对或信号通路。</li>
<li><strong>探索疾病机制：</strong> 例如，在糖尿病中胰岛细胞与其他细胞的通讯障碍；在自身免疫病中免疫细胞的异常互动。</li>
<li><strong>药物靶点发现：</strong> 识别可以干预异常细胞通讯的潜在治疗靶点。</li>
</ul>
<p><strong>示例代码（使用CellChat进行细胞-细胞通讯分析）：</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install.packages(&quot;devtools&quot;)</span></span><br><span class="line"><span class="comment"># devtools::install_github(&quot;sqjin/CellChat&quot;)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>CellChat<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>patchwork<span class="punctuation">)</span> <span class="comment"># 用于组合图</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>Seurat<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 准备CellChat输入数据</span></span><br><span class="line"><span class="comment"># CellChat需要两个主要输入：</span></span><br><span class="line"><span class="comment">#   - 表达数据 (normalized data): 归一化后的表达矩阵</span></span><br><span class="line"><span class="comment">#   - 细胞元数据 (meta data): 包含细胞类型信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从Seurat对象中提取归一化后的数据</span></span><br><span class="line">data.input <span class="operator">&lt;-</span> GetAssayData<span class="punctuation">(</span>pbmc.integrated<span class="punctuation">,</span> assay <span class="operator">=</span> <span class="string">&quot;integrated&quot;</span><span class="punctuation">,</span> slot <span class="operator">=</span> <span class="string">&quot;data&quot;</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment"># 如果Seurat对象没有&quot;integrated&quot; assay，可以使用&quot;RNA&quot; assay的&quot;data&quot; slot</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取细胞类型信息（假设您的细胞类型注释在&#x27;celltype_annotations&#x27;元数据列中）</span></span><br><span class="line">meta <span class="operator">&lt;-</span> pbmc.integrated<span class="operator">@</span>meta.data</span><br><span class="line">cell.type <span class="operator">&lt;-</span> meta<span class="operator">$</span>celltype_annotations <span class="comment"># 确保此列存在且包含您的最终细胞类型标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建CellChat对象</span></span><br><span class="line">cellchat <span class="operator">&lt;-</span> createCellChat<span class="punctuation">(</span>object <span class="operator">=</span> data.input<span class="punctuation">,</span> meta <span class="operator">=</span> cell.type<span class="punctuation">,</span> group.by <span class="operator">=</span> <span class="string">&quot;celltype&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 设置配体-受体相互作用数据库</span></span><br><span class="line"><span class="comment"># CellChat提供了多种数据库，如&#x27;Secreted Signaling&#x27; (分泌信号) 和 &#x27;Cell-Cell Contact&#x27; (细胞-细胞接触)</span></span><br><span class="line">CellChatDB <span class="operator">&lt;-</span> CellChatDB.human <span class="comment"># 或 CellChatDB.mouse</span></span><br><span class="line">cellchat<span class="operator">@</span>DB <span class="operator">&lt;-</span> CellChatDB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 预处理数据：识别过表达的配体和受体</span></span><br><span class="line">cellchat <span class="operator">&lt;-</span> subsetData<span class="punctuation">(</span>cellchat<span class="punctuation">)</span> <span class="comment"># 筛选出数据库中存在的基因</span></span><br><span class="line">future<span class="operator">::</span>plan<span class="punctuation">(</span><span class="string">&quot;multisession&quot;</span><span class="punctuation">,</span> workers <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span> <span class="comment"># 可以并行计算，加快速度</span></span><br><span class="line">cellchat <span class="operator">&lt;-</span> identifyOverExpressedGenes<span class="punctuation">(</span>cellchat<span class="punctuation">)</span></span><br><span class="line">cellchat <span class="operator">&lt;-</span> identifyOverExpressedLigandReceptor<span class="punctuation">(</span>cellchat<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 推断细胞间通讯</span></span><br><span class="line">cellchat <span class="operator">&lt;-</span> computeCommunProb<span class="punctuation">(</span>cellchat<span class="punctuation">,</span> raw.data <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># raw.data=TRUE表示使用原始counts计算概率，然后进行归一化</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤低概率的通讯（可选）</span></span><br><span class="line">cellchat <span class="operator">&lt;-</span> filterCommunication<span class="punctuation">(</span>cellchat<span class="punctuation">,</span> min.cells <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 计算聚合的通讯网络</span></span><br><span class="line">cellchat <span class="operator">&lt;-</span> computeCommunProbPathway<span class="punctuation">(</span>cellchat<span class="punctuation">)</span></span><br><span class="line">cellchat <span class="operator">&lt;-</span> aggregateNet<span class="punctuation">(</span>cellchat<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 可视化网络</span></span><br><span class="line"><span class="comment"># 整体网络图 (Chord diagram)</span></span><br><span class="line">netVisual_circos<span class="punctuation">(</span>cellchat<span class="operator">@</span>net<span class="operator">$</span>count<span class="punctuation">,</span> layout <span class="operator">=</span> <span class="string">&quot;circular&quot;</span><span class="punctuation">,</span> color.use <span class="operator">=</span> cellchat<span class="operator">@</span>meta<span class="operator">$</span>colors<span class="punctuation">,</span> link.arr.lwd <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> link.arr.width <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 热图展示通讯强度 (根据信号数量或总强度)</span></span><br><span class="line">netVisual_heatmap<span class="punctuation">(</span>cellchat<span class="punctuation">,</span> measure <span class="operator">=</span> <span class="string">&quot;count&quot;</span><span class="punctuation">)</span> <span class="comment"># count表示信号数量，weight表示总强度</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化特定信号通路</span></span><br><span class="line"><span class="comment"># 假设我们想看&#x27;MHC-I&#x27;通路的通讯</span></span><br><span class="line"><span class="comment"># pathways.show &lt;- c(&quot;MHC-I&quot;) # 替换为您感兴趣的通路名称</span></span><br><span class="line"><span class="comment"># netVisual_bubble(cellchat, sources.use = c(&quot;CD4 T cells&quot;), targets.use = c(&quot;CD14 Monocytes&quot;, &quot;B cells&quot;), signaling = pathways.show, remove.isolate = FALSE)</span></span><br><span class="line"><span class="comment"># netVisual_pathway(cellchat, pathway.name = pathways.show, edge.width.max = 1.5, layout = &quot;circle&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 识别关键信号配体/受体和信号通路</span></span><br><span class="line">cellchat <span class="operator">&lt;-</span> netAnalysis_computeCentrality<span class="punctuation">(</span>cellchat<span class="punctuation">,</span> slot.name <span class="operator">=</span> <span class="string">&quot;netP&quot;</span><span class="punctuation">)</span> <span class="comment"># compute the network centrality scores</span></span><br><span class="line">netAnalysis_node_strength<span class="punctuation">(</span>cellchat<span class="punctuation">,</span> signaling <span class="operator">=</span> <span class="string">&quot;MHC-I&quot;</span><span class="punctuation">)</span> <span class="comment"># 可视化某个通路的节点重要性</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. 比较不同条件下的通讯（如果您有多个样本）</span></span><br><span class="line"><span class="comment"># mergeCellChat(list(cellchat_group1, cellchat_group2)) # 将多个CellChat对象合并进行比较</span></span><br></pre></td></tr></table></figure>
<p>细胞-细胞通讯分析是单细胞数据分析的又一个强大功能，它将我们对细胞“独白”的理解提升到细胞“对话”的层面，从而更全面地揭示复杂生物系统中的相互作用机制。</p>
<hr>
<h3 id="高级分析与挑战：超越基础，迈向未来">高级分析与挑战：超越基础，迈向未来</h3>
<p>单细胞转录组测序分析领域正以惊人的速度发展，新的技术和计算方法层出不穷。除了上述核心分析步骤外，还有许多高级分析方法和新的挑战等待我们去探索。</p>
<h4 id="1-多模态数据整合-Multi-modal-Data-Integration">1. 多模态数据整合 (Multi-modal Data Integration)</h4>
<p>生命活动是多层面的，基因表达只是其中之一。细胞还具有蛋白质表达、染色质可及性、空间位置等多种信息。将这些不同类型的数据在单细胞层面进行整合，可以提供对细胞状态更全面、更精确的描述。</p>
<ul>
<li><strong>CITE-seq (Cellular Indexing of Transcriptomes and Epitopes by Sequencing)：</strong> 同时测量细胞表面的蛋白质表达（通过抗体偶联寡核苷酸标记）和mRNA表达。整合这两种模态的数据，可以更准确地鉴定细胞类型（如T细胞的CD4/CD8亚型）、识别稀有细胞群，并揭示转录组和蛋白质组之间的潜在关联。</li>
<li><strong>单细胞ATAC-seq (scATAC-seq) 与scRNA-seq整合：</strong> scATAC-seq测量染色质的开放性（即DNA的可及性），反映了基因调控元件的活性。整合scRNA-seq（基因表达）和scATAC-seq（基因调控）数据，可以更深入地理解基因表达调控机制，预测转录因子活性，并识别顺式调控元件。</li>
<li><strong>整合工具：</strong> Seurat v4+ 提供了强大的整合框架（如<code>FindMultiModalAnchors</code>），可以整合RNA和蛋白质数据（CITE-seq），或RNA和ATAC数据。其他工具如MOFA+、LIGER等也支持多模态数据整合。</li>
</ul>
<h4 id="2-空间转录组学-Spatial-Transcriptomics">2. 空间转录组学 (Spatial Transcriptomics)</h4>
<p>传统的单细胞测序技术在解离组织时，会丢失细胞在组织中的原始空间位置信息。<strong>空间转录组学</strong>技术（如Visium、Slide-seqV2、MERFISH、Vizgen Xenium）能够同时获取基因表达信息和细胞在组织中的精确空间位置信息。</p>
<ul>
<li><strong>整合优势：</strong> 将空间转录组学数据与单细胞RNA-seq数据整合，可以将单细胞数据中识别出的细胞类型映射回组织原位，从而理解细胞类型在组织微环境中的空间分布模式、细胞-细胞相互作用的邻近关系，以及疾病发生发展过程中组织结构的改变。</li>
<li><strong>分析挑战：</strong> 空间数据的处理和可视化需要特定的工具，同时需要开发新的方法来融合单细胞分辨率的基因表达信息和空间坐标信息。</li>
</ul>
<h4 id="3-基因调控网络推断-Gene-Regulatory-Network-Inference">3. 基因调控网络推断 (Gene Regulatory Network Inference)</h4>
<p>在细胞命运决定和状态转换过程中，转录因子（Transcription Factors, TFs）通过结合基因的调控区域来控制基因表达，形成复杂的基因调控网络。</p>
<ul>
<li><strong>工具：</strong> SCENIC、Pando、Velociraptor等工具可以利用单细胞数据推断转录因子活性和其靶基因的调控关系，从而构建细胞类型特异性的基因调控网络。</li>
<li><strong>应用：</strong> 揭示驱动细胞分化、疾病发生的核心转录因子和信号通路。</li>
</ul>
<h4 id="4-RNA剪接异构体分析-RNA-Splicing-Isoform-Analysis">4. RNA剪接异构体分析 (RNA Splicing Isoform Analysis)</h4>
<p>大多数单细胞RNA-seq技术（如10x Genomics）主要捕获基因的3’端，难以提供全长转录本信息，因此无法很好地分析RNA剪接异构体。</p>
<ul>
<li><strong>长读长测序 (Long-read Sequencing)：</strong> PacBio Iso-Seq、Oxford Nanopore Technologies (ONT) 等长读长测序技术，可以直接测序全长mRNA分子，从而在单细胞层面识别和量化剪接异构体。</li>
<li><strong>挑战：</strong> 成本高，通量相对较低，数据分析流程复杂。</li>
</ul>
<h4 id="5-计算资源与可伸缩性-Computational-Resources-and-Scalability">5. 计算资源与可伸缩性 (Computational Resources and Scalability)</h4>
<p>随着单细胞数据集规模的不断扩大（从几千个细胞到数百万甚至上亿个细胞），计算资源成为瓶颈。</p>
<ul>
<li><strong>挑战：</strong> 数据存储、内存消耗、计算时间。</li>
<li><strong>解决方案：</strong>
<ul>
<li><strong>云计算：</strong> AWS、Google Cloud、Azure等提供强大的计算资源。</li>
<li><strong>分布式计算：</strong> Apache Spark等框架。</li>
<li><strong>算法优化：</strong> 开发更高效、内存更优化的算法（如UMAP比t-SNE更快）。</li>
<li><strong>稀疏矩阵操作：</strong> 大部分单细胞数据是稀疏的，利用稀疏矩阵数据结构可以节省大量内存和计算时间。</li>
</ul>
</li>
</ul>
<h4 id="6-数据质量评估与标准化-Data-Quality-Assessment-and-Standardization">6. 数据质量评估与标准化 (Data Quality Assessment and Standardization)</h4>
<p>尽管有QC步骤，但由于实验技术的复杂性，单细胞数据质量仍然参差不齐。</p>
<ul>
<li><strong>挑战：</strong> 如何客观、全面地评估单细胞实验和分析的质量？如何建立一套标准化的数据处理和分析流程？</li>
<li><strong>解决方案：</strong> 制定最佳实践指南（如HCA的标准化流程），开发自动化报告工具，推动数据共享和标准化。</li>
</ul>
<h4 id="7-数据解读与生物学验证">7. 数据解读与生物学验证</h4>
<p>生物信息学分析的结果仅仅是推测和假设，最终仍需要通过传统的湿实验方法（如流式细胞术、免疫组织化学、FISH、CRISPR基因编辑等）进行验证，以确认其生物学意义。</p>
<ul>
<li><strong>挑战：</strong> 桥接计算结果与实验验证之间的鸿沟。</li>
<li><strong>解决方案：</strong> 紧密的跨学科合作，生物信息学专家与实验生物学家共同设计实验，解释结果。</li>
</ul>
<h4 id="8-人工智能与深度学习在单细胞领域中的应用">8. 人工智能与深度学习在单细胞领域中的应用</h4>
<p>随着AI技术的成熟，深度学习模型开始被应用于单细胞数据分析：</p>
<ul>
<li><strong>降噪与插补 (Imputation)：</strong> 使用自编码器（Autoencoders）或变分自编码器（VAEs）等深度学习模型，学习数据内在的低维表示，从而去除噪音并填补掉线值。</li>
<li><strong>细胞类型分类与预测：</strong> 构建深度神经网络模型，从已标记的数据中学习细胞特征，并对新细胞进行分类。</li>
<li><strong>轨迹推断与状态预测：</strong> 深度学习模型能够捕捉数据中复杂的非线性关系，有望实现更精确的轨迹推断和细胞状态预测。</li>
<li><strong>多模态数据整合：</strong> 深度学习，特别是多模态学习模型，在整合异构数据方面展现出巨大潜力。</li>
</ul>
<p>这些高级分析和挑战预示着单细胞领域激动人心的未来。随着技术的不断进步，我们有能力从单细胞层面解析生命体的奥秘，为疾病的诊断、治疗和药物开发提供前所未有的见解。</p>
<hr>
<h3 id="结论：微观世界的宏大叙事">结论：微观世界的宏大叙事</h3>
<p>单细胞转录组测序分析，从最初的技术萌芽，到如今成为生命科学研究中不可或缺的强大工具，其发展历程堪称一场革命。它打破了传统批量测序的局限，让我们得以摆脱“大锅饭”式的平均化视角，深入到每一个细胞的微观世界，聆听它们独特的“基因表达故事”。</p>
<p>从原始数据的严苛质控，到精妙的归一化与批次校正，再到多样的降维与聚类算法，我们学会了如何从庞杂、稀疏的高维数据中抽丝剥茧，识别出肉眼无法分辨的细胞亚群。细胞类型鉴定赋予了这些抽象的数字标签以生物学意义，而差异表达分析则揭示了不同细胞群体的独特功能和分子特征。更进一步，轨迹推断为我们描绘了细胞状态连续演变的动态画卷，而细胞-细胞通讯分析则搭建起了细胞间对话的桥梁，揭示了复杂生命系统中细胞协作的奥秘。</p>
<p>然而，单细胞领域的故事远未结束。随着多组学数据整合、空间转录组学、长读长测序等新兴技术的不断涌现，以及人工智能和深度学习在数据分析中的日益深入应用，我们正逐步迈向一个更加全面、精细地理解生命活动的新时代。每一个零值的背后都可能隐藏着生物学上的“有”，每一次微小的表达量波动都可能预示着细胞命运的转折，每一次细胞间的“对话”都可能决定着组织的健康与疾病。</p>
<p>单细胞转录组测序分析不仅是一系列计算方法的集合，更是一种全新的研究范式。它要求我们不仅掌握生物信息学的工具，更要深入理解其背后的统计学原理，并结合扎实的生物学知识进行合理的解释和严谨的验证。这是一场技术、数学与生物学深度融合的智力挑战，也是一场洞察生命奥秘的微观旅程。</p>
<p>作为技术爱好者，我们不仅是这些强大工具的使用者，更是其发展的推动者。每一次对数据特点的深刻理解，每一次对算法优化的尝试，每一次对新方法的探索，都将汇聚成推动整个领域前进的洪流。期待我们能持续深入学习，不断探索，共同迎接单细胞生物学所带来的无限可能，解码更多生命的精彩宏大叙事。</p>
<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/qmwneb946">qmwneb946</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://qmwneb946.dpdns.org/2025/07/22/2025-07-22-203539/">https://qmwneb946.dpdns.org/2025/07/22/2025-07-22-203539/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a> 许可协议。转载请注明来源 <a href="https://qmwneb946.dpdns.org" target="_blank">qmwneb946 的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/2025/">2025</a><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/">计算机科学</a><a class="post-meta__tags" href="/tags/%E5%8D%95%E7%BB%86%E8%83%9E%E8%BD%AC%E5%BD%95%E7%BB%84%E6%B5%8B%E5%BA%8F%E5%88%86%E6%9E%90/">单细胞转录组测序分析</a></div><div class="post-share"><div class="social-share" data-image="/img/icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/07/22/2025-07-22-203720/" title="蛋白质液-液相分离现象：细胞组织与生命调控的奥秘"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">蛋白质液-液相分离现象：细胞组织与生命调控的奥秘</div></div><div class="info-2"><div class="info-item-1">引言：细胞内部的混沌与秩序之舞 生命，这一宇宙中最精妙的现象，无时无刻不在细胞的微观世界中上演。长期以来，我们对细胞内部组织结构的理解，主要聚焦于由生物膜构成的各种细胞器：细胞核、线粒体、内质网、高尔基体等等，它们各自拥有清晰的边界，将特定的生物化学反应分隔开来，以维持细胞功能的有序进行。这种“膜包裹”的模式，构成了我们对细胞内部区室化的经典认知。 然而，随着科学研究的深入，一个令人着迷的新兴领域——蛋白质液-液相分离（Liquid-Liquid Phase Separation, LLPS）——正在彻底革新我们对细胞组织方式的理解。想象一下，细胞内部并非只有“有墙的房间”，还存在着许多“无墙的开放空间”，它们由特定的蛋白质和核酸分子自发聚集成液滴状的微相，形成一种动态的、非膜结合的细胞器。这些“液滴”或“凝聚体”能够浓缩特定的分子，加速或抑制生化反应，同时又保持着液态的动态特性，允许分子在其中自由扩散和交换。它们在细胞核和细胞质中广泛存在，例如核仁（nucleolus）、应激颗粒（stress granules）、P小体（P-bodies）和Cajal体（Cajal bodie...</div></div></div></a><a class="pagination-related" href="/2025/07/22/2025-07-22-200509/" title="细胞衰老与组织再生：生命的双刃剑"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">细胞衰老与组织再生：生命的双刃剑</div></div><div class="info-2"><div class="info-item-1"> 引言：时间的刻痕与生命的奥秘 欢迎各位技术爱好者和科学探索者！我是 qmwneb946，今天我们将踏上一段深入生命的旅程，探索一个既古老又前沿的生物学领域：细胞衰老（Cellular Senescence）与组织再生（Tissue Regeneration）。这两个概念如同一枚硬币的两面，共同塑造着我们生命的长度和质量。细胞衰老，这个在显微镜下被发现的细胞状态，曾一度被视为生命衰败的标志。然而，随着研究的深入，我们发现它远比想象中复杂，扮演着肿瘤抑制、发育塑形、伤口愈合等关键角色。但同时，它也是推动组织退化、器官衰竭、疾病发生的重要驱动力。 组织再生，则是生命对抗衰老和损伤的宏伟篇章。从壁虎断尾再生的惊人能力，到人类肝脏的自我修复，再生医学一直承载着我们延长健康寿命、恢复身体机能的梦想。但当衰老的细胞在组织中积累，当它们分泌的“衰老相关分泌表型”（SASP）因子改变了微环境，组织再生能力又将如何受到影响？ 本文将深入剖析细胞衰老的分子机制、其在生理和病理条件下的双重作用、它如何与组织再生能力相互作用，以及我们如何通过技术手段来干预这一过程。我们将从细胞生物学的微观层面，探讨基因...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/07/18/2025-07-18-082418/" title="机器学习算法的公平性问题：技术挑战与伦理困境"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">机器学习算法的公平性问题：技术挑战与伦理困境</div></div><div class="info-2"><div class="info-item-1">引言 机器学习 (ML) 正在迅速改变我们的世界，从医疗保健到金融，再到刑事司法系统，它的应用几乎无处不在。然而，随着 ML 系统的广泛部署，一个越来越令人担忧的问题浮出水面：公平性。  算法的输出可能反映并放大现有的社会偏见，导致对某些群体的不公平待遇。本文将深入探讨机器学习算法中的公平性问题，分析其技术根源和伦理困境，并探讨一些可能的解决方案。 偏见是如何进入机器学习模型的？ 机器学习模型的公平性问题并非源于算法本身的恶意，而是源于其训练数据的偏见。  这些偏见可能来自多种来源： 数据收集与标注  样本选择偏差 (Sampling Bias):  如果训练数据未能充分代表所有群体，模型就会学习到一个有偏的表示。例如，如果一个用于预测贷款偿还能力的模型主要基于白人申请人的数据，它可能会对少数族裔申请人产生不公平的负面预测。 测量偏差 (Measurement Bias):  数据收集过程中的错误或不一致也会引入偏见。例如，在犯罪预测模型中，如果某些社区的执法力度更大，导致该社区的犯罪数据被过度记录，模型就会对该社区产生负面偏见。 标注偏差 (Label Bias):  人工标注...</div></div></div></a><a class="pagination-related" href="/2025/07/18/2025-07-18-082429/" title="区块链技术与数字版权保护：一场技术与法律的博弈"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">区块链技术与数字版权保护：一场技术与法律的博弈</div></div><div class="info-2"><div class="info-item-1">大家好，我是你们的技术博主X，今天我们来聊一个非常热门的话题：区块链技术如何应用于数字版权保护。在数字内容飞速发展的时代，版权侵权问题日益严峻，传统的版权保护机制显得力不从心。而区块链技术，凭借其去中心化、不可篡改、透明等特性，为解决这一难题提供了新的思路。 区块链技术概述 首先，让我们简单回顾一下区块链技术的基本原理。区块链是一个由多个区块组成的链式数据库，每个区块包含一系列经过加密验证的交易记录。这些交易记录一旦被写入区块链，就无法被篡改或删除，保证了数据的完整性和安全性。  其核心技术包括：  密码学:  确保数据的安全性和完整性，例如哈希算法和数字签名。 共识机制:  例如工作量证明（PoW）和权益证明（PoS），用于维护区块链的统一性和安全性，防止恶意攻击。 分布式账本: 数据分布在多个节点上，提高了系统的容错性和安全性。  区块链如何保护数字版权 区块链技术可以为数字版权保护提供多种方案，主要体现在以下几个方面： 版权登记与确权 传统的版权登记流程繁琐且耗时，而区块链可以提供一个快速、透明的版权登记平台。创作者可以将作品的哈希值（作品的数字指纹）记录到区块链上，以此证...</div></div></div></a><a class="pagination-related" href="/2025/07/18/2025-07-18-082438/" title="云计算中的数据安全与隐私：挑战与应对"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">云计算中的数据安全与隐私：挑战与应对</div></div><div class="info-2"><div class="info-item-1">云计算为企业和个人提供了强大的计算资源和数据存储能力，但也带来了新的安全与隐私挑战。本文将深入探讨云计算环境下的数据安全与隐私问题，分析其背后的技术机制，并提出一些有效的应对策略。 云计算安全风险剖析 云计算环境中，数据安全与隐私面临着多种威胁，主要包括： 数据泄露与丢失 这是最常见的风险之一。  数据可能由于云提供商的内部安全漏洞、恶意攻击（例如SQL注入、DDoS攻击）、员工失误或意外事件（例如硬件故障）而泄露或丢失。  对于敏感数据，例如医疗记录、金融信息和个人身份信息，这种风险尤为严重。 数据违规 数据违规是指未经授权访问或使用数据的情况。这可能导致数据被篡改、删除或用于非法目的。  法规遵从性（例如 GDPR, CCPA）的压力也使得数据违规的代价越来越高。 权限管理不足 缺乏细粒度的访问控制机制可能导致数据被未授权的个人或应用程序访问。  复杂的云环境中，权限的管理和审核是一个极大的挑战。 数据完整性问题 云环境中的数据完整性需要得到保障，确保数据没有被未经授权的修改或破坏。  这需要使用诸如哈希算法和数字签名等技术来验证数据的完整性。 数据合规性 不同国家和地区对数...</div></div></div></a><a class="pagination-related" href="/2025/07/18/2025-07-18-082500/" title="物联网设备的网络安全协议：挑战与解决方案"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">物联网设备的网络安全协议：挑战与解决方案</div></div><div class="info-2"><div class="info-item-1">物联网 (IoT) 设备正以前所未有的速度渗透到我们生活的方方面面，从智能家居到工业自动化，再到医疗保健。然而，这种广泛的连接也带来了巨大的安全风险。由于物联网设备通常资源受限，安全性设计常常被忽视，导致它们成为网络攻击的理想目标。本文将深入探讨物联网设备面临的网络安全挑战，以及用于增强其安全性的各种协议和技术。 物联网安全面临的挑战 物联网设备的安全挑战与传统IT系统大相径庭，主要体现在以下几个方面： 资源受限 许多物联网设备具有有限的处理能力、内存和存储空间。这使得部署复杂的加密算法和安全协议变得困难，同时也增加了运行时开销。  运行资源消耗较大的安全软件可能会影响设备的性能甚至导致其崩溃。 设备异构性 物联网生态系统由各种各样的设备组成，这些设备运行不同的操作系统，使用不同的编程语言，并具有不同的安全特性。这种异构性使得实施统一的安全策略变得极其复杂。  很难找到一个适用于所有设备的通用安全解决方案。 数据隐私与安全 物联网设备通常会收集大量敏感数据，例如个人健康信息、位置数据和财务信息。保护这些数据的隐私和安全至关重要，但由于设备自身的安全缺陷和数据传输过程中的漏洞，这成...</div></div></div></a><a class="pagination-related" href="/2025/07/18/2025-07-18-082528/" title="量子计算对现代密码学的威胁：后量子密码学的挑战与机遇"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">量子计算对现代密码学的威胁：后量子密码学的挑战与机遇</div></div><div class="info-2"><div class="info-item-1">量子计算的飞速发展为许多领域带来了革命性的变革，但也对现有的密码体系构成了前所未有的挑战。本文将深入探讨量子计算如何威胁现代密码学，以及我们如何应对这一挑战。 量子计算的优势与密码学的困境 经典计算机基于比特，其值只能是 0 或 1。而量子计算机利用量子比特，可以同时表示 0 和 1 的叠加态，这使得它们能够进行并行计算，处理能力远超经典计算机。  这种巨大的计算能力为解决某些目前被认为是“不可解”的问题提供了可能性，其中就包括许多现代密码学的基石。 例如，RSA 算法，广泛应用于电子商务和安全通信，其安全性依赖于大数分解的困难性。经典计算机分解一个很大的数需要指数级的时间，因此被认为是安全的。然而，Shor 算法，一个在量子计算机上运行的算法，能够以多项式时间分解大数。这意味着，一台足够强大的量子计算机能够轻易破解 RSA 加密，从而威胁到大量的在线交易、数据安全以及国家安全。 同样，椭圆曲线密码学 (ECC)，另一种广泛使用的密码算法，其安全性也依赖于某些数学问题的复杂性。然而，量子计算机也能够有效地解决这些问题，例如离散对数问题。 Shor 算法与 Grover 算法：量子...</div></div></div></a><a class="pagination-related" href="/2025/07/18/2025-07-18-082537/" title="图论算法在社交网络分析中的应用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">图论算法在社交网络分析中的应用</div></div><div class="info-2"><div class="info-item-1">社交网络已经成为我们生活中不可或缺的一部分。从Facebook和Twitter到微信和微博，这些平台连接着数十亿用户，产生着海量的数据。而理解这些数据，挖掘其背后的规律和价值，就需要借助强大的数学工具——图论。本文将深入探讨图论算法在社交网络分析中的多种应用。 社交网络的图表示 在图论中，社交网络可以被自然地表示为图 G=(V,E)G = (V, E)G=(V,E)，其中 VVV 代表用户集合（节点），EEE 代表用户之间的关系集合（边）。例如，在Facebook中，每个用户是一个节点，如果两个用户是朋友，则在他们之间存在一条无向边；在Twitter中，如果用户A关注用户B，则存在一条从A指向B的有向边。边的权重可以表示关系的强度（例如，朋友关系的亲密度，或者互动频率）。  这种图表示为我们分析社交网络提供了坚实的基础。 核心图论算法及其应用 社区发现 社区发现旨在将社交网络划分成多个紧密连接的社区（也称为集群）。这对于理解用户群体、推荐系统以及病毒式营销等都至关重要。常用的算法包括：  Louvain算法:  一种贪婪的启发式算法，通过迭代优化模块度来寻找最佳社区结构。模块度 ...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">qmwneb946</div><div class="author-info-description">一个专注于技术分享的个人博客，涵盖编程、算法、系统设计等内容</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">703</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">707</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/qmwneb946"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/qmwneb946" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:qmwneb946@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">代码与远方，技术与生活交织的篇章。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E8%A8%80%EF%BC%9A%E4%BB%8E%E2%80%9C%E5%A4%A7%E9%94%85%E9%A5%AD%E2%80%9D%E5%88%B0%E2%80%9C%E7%B2%BE%E7%BB%86%E8%8F%9C%E2%80%9D%E2%80%94%E2%80%94%E5%8D%95%E7%BB%86%E8%83%9E%E8%BD%AC%E5%BD%95%E7%BB%84%E5%AD%A6%E7%9A%84%E9%9D%A9%E5%91%BD"><span class="toc-number">1.</span> <span class="toc-text">引言：从“大锅饭”到“精细菜”——单细胞转录组学的革命</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9E%E8%BD%AC%E5%BD%95%E7%BB%84%E6%B5%8B%E5%BA%8F%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0%EF%BC%9A%E4%BB%8E%E5%AE%8F%E8%A7%82%E5%88%B0%E5%BE%AE%E8%A7%82%E7%9A%84%E9%A3%9E%E8%B7%83"><span class="toc-number">2.</span> <span class="toc-text">单细胞转录组测序技术概述：从宏观到微观的飞跃</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E6%8D%95%E8%8E%B7%E4%B8%8E%E6%96%87%E5%BA%93%E5%88%B6%E5%A4%87%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">细胞捕获与文库制备原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E6%B5%81%E6%8A%80%E6%9C%AF%E5%B9%B3%E5%8F%B0%E6%AF%94%E8%BE%83"><span class="toc-number">2.2.</span> <span class="toc-text">主流技术平台比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9E%E8%BD%AC%E5%BD%95%E7%BB%84%E6%95%B0%E6%8D%AE%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.3.</span> <span class="toc-text">单细胞转录组数据的特点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86%EF%BC%9A%E4%BB%8E%E6%B5%8B%E5%BA%8FReads%E5%88%B0UMI%E8%AE%A1%E6%95%B0%E7%9F%A9%E9%98%B5"><span class="toc-number">3.</span> <span class="toc-text">原始数据预处理：从测序Reads到UMI计数矩阵</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FASTQ%E6%96%87%E4%BB%B6%E5%88%B0UMI%E8%AE%A1%E6%95%B0%E7%9F%A9%E9%98%B5"><span class="toc-number">3.1.</span> <span class="toc-text">FASTQ文件到UMI计数矩阵</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%A8%E9%87%8F%E6%8E%A7%E5%88%B6-Quality-Control-QC"><span class="toc-number">3.2.</span> <span class="toc-text">质量控制 (Quality Control, QC)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BD%92%E4%B8%80%E5%8C%96%E4%B8%8E%E5%B0%BA%E5%BA%A6%E5%8C%96%EF%BC%9A%E6%B6%88%E9%99%A4%E6%8A%80%E6%9C%AF%E5%81%8F%E5%B7%AE%EF%BC%8C%E6%8F%AD%E7%A4%BA%E7%94%9F%E7%89%A9%E5%AD%A6%E7%9C%9F%E5%AE%9E"><span class="toc-number">4.</span> <span class="toc-text">数据归一化与尺度化：消除技术偏差，揭示生物学真实</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%BD%92%E4%B8%80%E5%8C%96%EF%BC%9F"><span class="toc-number">4.1.</span> <span class="toc-text">为什么需要归一化？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%BD%92%E4%B8%80%E5%8C%96%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">常用归一化方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%B0%BA%E5%BA%A6%E5%8C%96-Scaling"><span class="toc-number">4.3.</span> <span class="toc-text">数据尺度化 (Scaling)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E6%AC%A1%E6%95%88%E5%BA%94%E6%A0%A1%E6%AD%A3-Batch-Effect-Correction"><span class="toc-number">4.4.</span> <span class="toc-text">批次效应校正 (Batch Effect Correction)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%8D%E7%BB%B4%EF%BC%9A%E6%8F%AD%E7%A4%BA%E9%AB%98%E7%BB%B4%E6%95%B0%E6%8D%AE%E4%B8%AD%E7%9A%84%E5%86%85%E5%9C%A8%E7%BB%93%E6%9E%84"><span class="toc-number">5.</span> <span class="toc-text">降维：揭示高维数据中的内在结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E6%88%90%E5%88%86%E5%88%86%E6%9E%90-Principal-Component-Analysis-PCA"><span class="toc-number">5.1.</span> <span class="toc-text">主成分分析 (Principal Component Analysis, PCA)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#t-SNE-t-Distributed-Stochastic-Neighbor-Embedding"><span class="toc-number">5.2.</span> <span class="toc-text">t-SNE (t-Distributed Stochastic Neighbor Embedding)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UMAP-Uniform-Manifold-Approximation-and-Projection"><span class="toc-number">5.3.</span> <span class="toc-text">UMAP (Uniform Manifold Approximation and Projection)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E9%99%8D%E7%BB%B4%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.</span> <span class="toc-text">选择降维方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90%EF%BC%9A%E8%AF%86%E5%88%AB%E7%BB%86%E8%83%9E%E4%BA%9A%E7%BE%A4"><span class="toc-number">6.</span> <span class="toc-text">聚类分析：识别细胞亚群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E7%B1%BB%E6%96%B9%E6%B3%95"><span class="toc-number">6.1.</span> <span class="toc-text">聚类方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E7%B1%BB%E5%88%86%E8%BE%A8%E7%8E%87-Resolution"><span class="toc-number">6.2.</span> <span class="toc-text">聚类分辨率 (Resolution)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%84%E4%BC%B0%E8%81%9A%E7%B1%BB%E7%BB%93%E6%9E%9C"><span class="toc-number">6.3.</span> <span class="toc-text">评估聚类结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A%EF%BC%9A%E4%B8%BA%E7%BB%86%E8%83%9E%E4%BA%9A%E7%BE%A4%E5%91%BD%E5%90%8D"><span class="toc-number">7.</span> <span class="toc-text">细胞类型鉴定：为细胞亚群命名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E4%BA%8E%E5%B7%B2%E7%9F%A5%E6%A0%87%E5%BF%97%E5%9F%BA%E5%9B%A0%E7%9A%84%E6%89%8B%E5%8A%A8%E9%89%B4%E5%AE%9A-Manual-Annotation-using-Marker-Genes"><span class="toc-number">7.1.</span> <span class="toc-text">1. 基于已知标志基因的手动鉴定 (Manual Annotation using Marker Genes)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%87%AA%E5%8A%A8%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E6%B3%A8%E9%87%8A%E5%B7%A5%E5%85%B7-Automated-Cell-Type-Annotation"><span class="toc-number">7.2.</span> <span class="toc-text">2. 自动细胞类型注释工具 (Automated Cell Type Annotation)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BB%93%E5%90%88%E6%B5%81%E5%BC%8F%E7%BB%86%E8%83%9E%E6%9C%AF%E6%95%B0%E6%8D%AE%E6%88%96%E7%A9%BA%E9%97%B4%E8%BD%AC%E5%BD%95%E7%BB%84%E5%AD%A6%E6%95%B0%E6%8D%AE"><span class="toc-number">7.3.</span> <span class="toc-text">3. 结合流式细胞术数据或空间转录组学数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90%EF%BC%9A%E6%8F%AD%E7%A4%BA%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E9%97%B4%E7%9A%84%E5%9F%BA%E5%9B%A0%E8%A1%A8%E8%BE%BE%E5%B7%AE%E5%BC%82"><span class="toc-number">8.</span> <span class="toc-text">差异表达分析：揭示细胞类型间的基因表达差异</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9E%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-number">8.1.</span> <span class="toc-text">单细胞差异表达分析的挑战</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95"><span class="toc-number">8.2.</span> <span class="toc-text">常用差异表达分析方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E7%BB%93%E6%9E%9C%E7%9A%84%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">8.3.</span> <span class="toc-text">差异表达结果的解读与可视化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%8C%E9%9B%86%E5%88%86%E6%9E%90-Enrichment-Analysis"><span class="toc-number">8.4.</span> <span class="toc-text">富集分析 (Enrichment Analysis)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%A8%E8%BF%B9%E6%8E%A8%E6%96%AD%EF%BC%9A%E8%BF%BD%E8%B8%AA%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%BC%94%E5%8F%98"><span class="toc-number">9.</span> <span class="toc-text">轨迹推断：追踪细胞状态的连续演变</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%9F%E6%97%B6%E5%BA%8F%E4%B8%8E%E7%9C%9F%E5%AE%9E%E6%97%B6%E9%97%B4"><span class="toc-number">9.1.</span> <span class="toc-text">拟时序与真实时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%A8%E8%BF%B9%E6%8E%A8%E6%96%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">9.2.</span> <span class="toc-text">轨迹推断的基本原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E8%BD%A8%E8%BF%B9%E6%8E%A8%E6%96%AD%E5%B7%A5%E5%85%B7"><span class="toc-number">9.3.</span> <span class="toc-text">常用轨迹推断工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%A8%E8%BF%B9%E6%8E%A8%E6%96%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">9.4.</span> <span class="toc-text">轨迹推断的应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%86%E8%83%9E-%E7%BB%86%E8%83%9E%E9%80%9A%E8%AE%AF%E5%88%86%E6%9E%90%EF%BC%9A%E8%A7%A3%E7%A0%81%E7%BB%86%E8%83%9E%E9%97%B4%E7%9A%84%E5%AF%B9%E8%AF%9D"><span class="toc-number">10.</span> <span class="toc-text">细胞-细胞通讯分析：解码细胞间的对话</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">10.1.</span> <span class="toc-text">基本原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%BB%86%E8%83%9E-%E7%BB%86%E8%83%9E%E9%80%9A%E8%AE%AF%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">10.2.</span> <span class="toc-text">常用细胞-细胞通讯分析工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%83%9E-%E7%BB%86%E8%83%9E%E9%80%9A%E8%AE%AF%E5%88%86%E6%9E%90%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">10.3.</span> <span class="toc-text">细胞-细胞通讯分析的应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%88%86%E6%9E%90%E4%B8%8E%E6%8C%91%E6%88%98%EF%BC%9A%E8%B6%85%E8%B6%8A%E5%9F%BA%E7%A1%80%EF%BC%8C%E8%BF%88%E5%90%91%E6%9C%AA%E6%9D%A5"><span class="toc-number">11.</span> <span class="toc-text">高级分析与挑战：超越基础，迈向未来</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%A4%9A%E6%A8%A1%E6%80%81%E6%95%B0%E6%8D%AE%E6%95%B4%E5%90%88-Multi-modal-Data-Integration"><span class="toc-number">11.1.</span> <span class="toc-text">1. 多模态数据整合 (Multi-modal Data Integration)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%A9%BA%E9%97%B4%E8%BD%AC%E5%BD%95%E7%BB%84%E5%AD%A6-Spatial-Transcriptomics"><span class="toc-number">11.2.</span> <span class="toc-text">2. 空间转录组学 (Spatial Transcriptomics)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9F%BA%E5%9B%A0%E8%B0%83%E6%8E%A7%E7%BD%91%E7%BB%9C%E6%8E%A8%E6%96%AD-Gene-Regulatory-Network-Inference"><span class="toc-number">11.3.</span> <span class="toc-text">3. 基因调控网络推断 (Gene Regulatory Network Inference)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-RNA%E5%89%AA%E6%8E%A5%E5%BC%82%E6%9E%84%E4%BD%93%E5%88%86%E6%9E%90-RNA-Splicing-Isoform-Analysis"><span class="toc-number">11.4.</span> <span class="toc-text">4. RNA剪接异构体分析 (RNA Splicing Isoform Analysis)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%AE%A1%E7%AE%97%E8%B5%84%E6%BA%90%E4%B8%8E%E5%8F%AF%E4%BC%B8%E7%BC%A9%E6%80%A7-Computational-Resources-and-Scalability"><span class="toc-number">11.5.</span> <span class="toc-text">5. 计算资源与可伸缩性 (Computational Resources and Scalability)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%95%B0%E6%8D%AE%E8%B4%A8%E9%87%8F%E8%AF%84%E4%BC%B0%E4%B8%8E%E6%A0%87%E5%87%86%E5%8C%96-Data-Quality-Assessment-and-Standardization"><span class="toc-number">11.6.</span> <span class="toc-text">6. 数据质量评估与标准化 (Data Quality Assessment and Standardization)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E6%95%B0%E6%8D%AE%E8%A7%A3%E8%AF%BB%E4%B8%8E%E7%94%9F%E7%89%A9%E5%AD%A6%E9%AA%8C%E8%AF%81"><span class="toc-number">11.7.</span> <span class="toc-text">7. 数据解读与生物学验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%9C%A8%E5%8D%95%E7%BB%86%E8%83%9E%E9%A2%86%E5%9F%9F%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">11.8.</span> <span class="toc-text">8. 人工智能与深度学习在单细胞领域中的应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA%EF%BC%9A%E5%BE%AE%E8%A7%82%E4%B8%96%E7%95%8C%E7%9A%84%E5%AE%8F%E5%A4%A7%E5%8F%99%E4%BA%8B"><span class="toc-number">12.</span> <span class="toc-text">结论：微观世界的宏大叙事</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/%E5%8D%9A%E5%BC%88%E8%AE%BA%E5%9F%BA%E7%A1%80/" title="博弈论基础">博弈论基础</a><time datetime="2025-07-23T11:46:17.225Z" title="发表于 2025-07-23 19:46:17">2025-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/hello-world/" title="Hello World">Hello World</a><time datetime="2025-07-23T11:46:17.224Z" title="发表于 2025-07-23 19:46:17">2025-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/2025-07-23-114340/" title="数字孪生在城市规划中的革命性应用：构建智能城市的未来">数字孪生在城市规划中的革命性应用：构建智能城市的未来</a><time datetime="2025-07-23T03:43:40.000Z" title="发表于 2025-07-23 11:43:40">2025-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/2025-07-23-114234/" title="天地一体化信息网络：构建未来全域智能连接的终极蓝图">天地一体化信息网络：构建未来全域智能连接的终极蓝图</a><time datetime="2025-07-23T03:42:34.000Z" title="发表于 2025-07-23 11:42:34">2025-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/2025-07-23-114105/" title="掌控语言的魔力：深度探索文本生成的可控性研究">掌控语言的魔力：深度探索文本生成的可控性研究</a><time datetime="2025-07-23T03:41:05.000Z" title="发表于 2025-07-23 11:41:05">2025-07-23</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By qmwneb946</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (true) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'qmwneb946/blog',
      'data-repo-id': 'R_kgDOPM6cWw',
      'data-category-id': 'DIC_kwDOPM6cW84CtEzo',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>